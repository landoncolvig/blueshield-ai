<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlueShield AI | Law Enforcement Training Platform</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700&family=Source+Sans+3:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --navy-deep: #0A1628;
            --navy-mid: #132238;
            --navy-light: #1E3A5F;
            --tactical-blue: #2E5A8C;
            --accent-gold: #C9A227;
            --accent-gold-bright: #E8C547;
            --text-primary: #FFFFFF;
            --text-secondary: #A8B8C8;
            --text-muted: #6B7B8B;
            --border-color: rgba(168, 184, 200, 0.15);
            --success: #34D399;
            --warning: #FBBF24;
            --error: #F87171;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Source Sans 3', -apple-system, sans-serif;
            background: var(--navy-deep);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .grid-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            background-image:
                linear-gradient(rgba(46, 90, 140, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(46, 90, 140, 0.03) 1px, transparent 1px);
            background-size: 60px 60px;
        }

        .content-wrapper {
            position: relative;
            z-index: 1;
        }

        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            padding: 1rem 2rem;
            background: rgba(10, 22, 40, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--tactical-blue), var(--navy-light));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--accent-gold);
        }

        .logo-icon svg {
            width: 24px;
            height: 24px;
            fill: var(--accent-gold);
        }

        .logo-text {
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: 0.05em;
            color: var(--text-primary);
        }

        .logo-text span {
            color: var(--accent-gold);
        }

        nav {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        nav a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            transition: color 0.2s;
        }

        nav a:hover {
            color: var(--text-primary);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.95rem;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .btn-primary {
            background: var(--accent-gold);
            color: var(--navy-deep);
        }

        .btn-primary:hover {
            background: var(--accent-gold-bright);
            transform: translateY(-1px);
        }

        .btn-outline {
            background: transparent;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-outline:hover {
            border-color: var(--accent-gold);
            color: var(--accent-gold);
        }

        .btn-large {
            padding: 1rem 2rem;
            font-size: 1.1rem;
        }

        .hero {
            min-height: 100vh;
            display: flex;
            align-items: center;
            padding: 8rem 2rem 4rem;
            position: relative;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 50%;
            height: 100%;
            background: radial-gradient(ellipse at 70% 30%, rgba(46, 90, 140, 0.15) 0%, transparent 60%);
            pointer-events: none;
        }

        .hero-content {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            align-items: center;
        }

        .hero-text {
            animation: fadeInUp 0.8s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(201, 162, 39, 0.1);
            border: 1px solid rgba(201, 162, 39, 0.3);
            padding: 0.5rem 1rem;
            border-radius: 100px;
            font-size: 0.85rem;
            color: var(--accent-gold);
            margin-bottom: 1.5rem;
        }

        .badge-dot {
            width: 8px;
            height: 8px;
            background: var(--accent-gold);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .hero h1 {
            font-family: 'Barlow Condensed', sans-serif;
            font-size: clamp(3rem, 6vw, 4.5rem);
            font-weight: 700;
            line-height: 1.1;
            letter-spacing: -0.01em;
            margin-bottom: 1.5rem;
        }

        .hero h1 span {
            color: var(--accent-gold);
        }

        .hero-subtitle {
            font-size: 1.25rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            max-width: 500px;
        }

        .hero-cta {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .hero-stats {
            display: flex;
            gap: 3rem;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
        }

        .stat {
            text-align: left;
        }

        .stat-value {
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .demo-preview {
            animation: fadeInUp 0.8s ease-out 0.2s both;
        }

        .chat-window {
            background: var(--navy-mid);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            overflow: hidden;
            box-shadow:
                0 25px 50px -12px rgba(0, 0, 0, 0.5),
                0 0 0 1px rgba(255, 255, 255, 0.05);
        }

        .chat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.25rem;
            background: var(--navy-light);
            border-bottom: 1px solid var(--border-color);
        }

        .chat-scenario {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .scenario-icon {
            width: 36px;
            height: 36px;
            background: rgba(201, 162, 39, 0.15);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .scenario-icon svg {
            width: 20px;
            height: 20px;
            stroke: var(--accent-gold);
            fill: none;
        }

        .scenario-info h3 {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 0.15rem;
        }

        .scenario-info span {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .mode-badge {
            background: rgba(52, 211, 153, 0.15);
            color: var(--success);
            padding: 0.35rem 0.75rem;
            border-radius: 100px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .chat-messages {
            padding: 1.25rem;
            min-height: 320px;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            max-width: 85%;
            animation: messageIn 0.4s ease-out both;
        }

        @keyframes messageIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message:nth-child(1) { animation-delay: 0.5s; }
        .message:nth-child(2) { animation-delay: 1s; }
        .message:nth-child(3) { animation-delay: 1.5s; }
        .message:nth-child(4) { animation-delay: 2s; }

        .message-system {
            text-align: center;
            max-width: 100%;
        }

        .message-system .message-content {
            display: inline-block;
            background: rgba(46, 90, 140, 0.3);
            color: var(--text-secondary);
            padding: 0.75rem 1.25rem;
            border-radius: 8px;
            font-size: 0.9rem;
            border: 1px solid var(--border-color);
        }

        .message-subject {
            align-self: flex-start;
        }

        .message-subject .message-content {
            background: var(--navy-light);
            border: 1px solid var(--border-color);
            padding: 0.85rem 1rem;
            border-radius: 4px 12px 12px 12px;
        }

        .message-officer {
            align-self: flex-end;
        }

        .message-officer .message-content {
            background: var(--tactical-blue);
            padding: 0.85rem 1rem;
            border-radius: 12px 4px 12px 12px;
        }

        .message-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-bottom: 0.35rem;
        }

        .hint-panel {
            margin-top: 0.5rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .hint-box {
            background: rgba(251, 191, 36, 0.1);
            border: 1px solid rgba(251, 191, 36, 0.25);
            border-radius: 8px;
            padding: 0.85rem 1rem;
            display: flex;
            gap: 0.75rem;
            animation: hintIn 0.5s ease-out 2.5s both;
        }

        @keyframes hintIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .hint-icon {
            flex-shrink: 0;
            width: 20px;
            height: 20px;
            color: var(--warning);
        }

        .hint-content {
            font-size: 0.85rem;
            color: var(--warning);
        }

        .hint-content strong {
            display: block;
            margin-bottom: 0.25rem;
        }

        .chat-input {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 1.25rem;
            background: var(--navy-deep);
            border-top: 1px solid var(--border-color);
        }

        .chat-input input {
            flex: 1;
            background: var(--navy-mid);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            color: var(--text-primary);
            font-size: 0.95rem;
            font-family: inherit;
        }

        .chat-input input::placeholder {
            color: var(--text-muted);
        }

        .chat-input input:focus {
            outline: none;
            border-color: var(--tactical-blue);
        }

        .send-btn {
            width: 44px;
            height: 44px;
            background: var(--accent-gold);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .send-btn:hover {
            background: var(--accent-gold-bright);
        }

        .send-btn svg {
            width: 20px;
            height: 20px;
            fill: var(--navy-deep);
        }

        .features {
            padding: 6rem 2rem;
            background: var(--navy-mid);
            position: relative;
        }

        .features::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--border-color), transparent);
        }

        .section-header {
            text-align: center;
            max-width: 700px;
            margin: 0 auto 4rem;
        }

        .section-label {
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            color: var(--accent-gold);
            margin-bottom: 1rem;
        }

        .section-title {
            font-family: 'Barlow Condensed', sans-serif;
            font-size: clamp(2rem, 4vw, 3rem);
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .section-subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .features-grid {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .feature-card {
            background: var(--navy-deep);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 2rem;
            transition: all 0.3s;
        }

        .feature-card:hover {
            border-color: var(--tactical-blue);
            transform: translateY(-4px);
        }

        .feature-icon {
            width: 48px;
            height: 48px;
            background: rgba(201, 162, 39, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1.25rem;
        }

        .feature-icon svg {
            width: 24px;
            height: 24px;
            stroke: var(--accent-gold);
            fill: none;
            stroke-width: 2;
        }

        .feature-card h3 {
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 1.35rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .feature-card p {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .pricing {
            padding: 6rem 2rem;
            position: relative;
        }

        .pricing-card {
            max-width: 500px;
            margin: 0 auto;
            background: linear-gradient(135deg, var(--navy-mid), var(--navy-light));
            border: 1px solid var(--accent-gold);
            border-radius: 16px;
            padding: 3rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .pricing-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-gold), var(--accent-gold-bright));
        }

        .promo-banner {
            position: absolute;
            top: 20px;
            right: -35px;
            background: var(--accent-gold);
            color: var(--navy-deep);
            padding: 0.5rem 3rem;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transform: rotate(45deg);
        }

        .pricing-title {
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .pricing-subtitle {
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        .price {
            margin-bottom: 0.5rem;
        }

        .price-amount {
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 4rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .price-period {
            font-size: 1.25rem;
            color: var(--text-muted);
        }

        .price-note {
            color: var(--accent-gold);
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 2rem;
        }

        .pricing-features {
            text-align: left;
            margin-bottom: 2rem;
        }

        .pricing-feature {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .pricing-feature:last-child {
            border-bottom: none;
        }

        .check-icon {
            width: 20px;
            height: 20px;
            background: rgba(52, 211, 153, 0.15);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .check-icon svg {
            width: 12px;
            height: 12px;
            stroke: var(--success);
            fill: none;
            stroke-width: 3;
        }

        .pricing-feature span {
            color: var(--text-secondary);
        }

        .btn-stripe {
            width: 100%;
            justify-content: center;
            font-size: 1.1rem;
            padding: 1rem 2rem;
        }

        footer {
            padding: 3rem 2rem;
            border-top: 1px solid var(--border-color);
            text-align: center;
        }

        .footer-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .footer-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .footer-logo .logo-text {
            font-size: 1.25rem;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1.5rem;
        }

        .footer-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.2s;
        }

        .footer-links a:hover {
            color: var(--text-primary);
        }

        .footer-disclaimer {
            font-size: 0.8rem;
            color: var(--text-muted);
            line-height: 1.7;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 22, 40, 0.95);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--navy-mid);
            border: none;
            border-radius: 0;
            width: 100vw;
            height: 100vh;
            max-width: 100vw;
            max-height: 100vh;
            overflow-y: auto;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .modal-close {
            position: fixed;
            top: 1rem;
            right: 1rem;
            width: 36px;
            z-index: 1001;
            height: 36px;
            background: var(--navy-deep);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            transition: all 0.2s;
            z-index: 10;
        }

        .modal-close:hover {
            border-color: var(--accent-gold);
            color: var(--accent-gold);
        }

        .demo-chat {
            padding: 0;
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
        }

        .demo-chat .chat-header {
            padding: 1.5rem;
        }

        .demo-chat .chat-messages {
            flex: 1;
            min-height: 200px;
            max-height: none;
            overflow-y: auto;
        }

        .demo-debrief {
            display: none;
            padding: 2rem;
            flex: 1;
            overflow-y: auto;
        }

        .demo-debrief.active {
            display: block;
        }

        .debrief-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .debrief-header h2 {
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
        }

        .debrief-score {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(52, 211, 153, 0.15);
            color: var(--success);
            padding: 0.5rem 1.25rem;
            border-radius: 100px;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .debrief-section {
            background: var(--navy-deep);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 1.25rem;
            margin-bottom: 1rem;
        }

        .debrief-section h3 {
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 1.1rem;
            color: var(--accent-gold);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .debrief-section p {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .debrief-section code {
            background: rgba(46, 90, 140, 0.3);
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            font-size: 0.85rem;
            color: var(--text-primary);
        }

        .debrief-item {
            display: flex;
            gap: 0.75rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .debrief-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .debrief-status {
            flex-shrink: 0;
        }

        .status-correct {
            color: var(--success);
        }

        .status-issue {
            color: var(--warning);
        }

        /* Subject Portrait */
        .subject-panel {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.25rem;
            background: var(--navy-deep);
            border-bottom: 1px solid var(--border-color);
        }

        .subject-portrait {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            background: var(--navy-light);
            border: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            transition: border-color 0.3s;
        }

        .subject-portrait.mood-calm { border-color: var(--success); }
        .subject-portrait.mood-nervous { border-color: var(--warning); }
        .subject-portrait.mood-agitated { border-color: #F97316; }
        .subject-portrait.mood-hostile { border-color: var(--error); }
        .subject-portrait.mood-defeated { border-color: var(--text-muted); }

        .portrait-face {
            font-size: 2.5rem;
            transition: all 0.3s;
        }

        .portrait-gif {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 10px;
        }

        .subject-info {
            flex: 1;
        }

        .subject-name {
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .subject-mood {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 0.25rem 0.6rem;
            border-radius: 100px;
            background: rgba(251, 191, 36, 0.15);
            color: var(--warning);
        }

        .subject-mood.mood-calm {
            background: rgba(52, 211, 153, 0.15);
            color: var(--success);
        }
        .subject-mood.mood-nervous {
            background: rgba(251, 191, 36, 0.15);
            color: var(--warning);
        }
        .subject-mood.mood-agitated {
            background: rgba(249, 115, 22, 0.15);
            color: #F97316;
        }
        .subject-mood.mood-hostile {
            background: rgba(248, 113, 113, 0.15);
            color: var(--error);
        }
        .subject-mood.mood-defeated {
            background: rgba(107, 123, 139, 0.15);
            color: var(--text-muted);
        }

        .mood-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 1.5s infinite;
        }

        .subject-action {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 0.35rem;
            font-style: italic;
        }

        /* Observation Panel */
        .observation-panel {
            background: var(--navy-deep);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 1.25rem;
        }

        .observation-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .observation-header svg {
            width: 16px;
            height: 16px;
            stroke: var(--accent-gold);
            fill: none;
        }

        .observation-header span {
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--accent-gold);
        }

        .observation-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .observation-tag {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            background: rgba(46, 90, 140, 0.2);
            border: 1px solid var(--border-color);
            padding: 0.35rem 0.65rem;
            border-radius: 4px;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .observation-tag.critical {
            background: rgba(248, 113, 113, 0.15);
            border-color: rgba(248, 113, 113, 0.3);
            color: var(--error);
        }

        .observation-tag.warning {
            background: rgba(251, 191, 36, 0.15);
            border-color: rgba(251, 191, 36, 0.3);
            color: var(--warning);
        }

        .observation-tag svg {
            width: 12px;
            height: 12px;
            stroke: currentColor;
            fill: none;
        }

        /* FI Card */
        .fi-card-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1.25rem;
            background: var(--navy-deep);
            border-top: 1px solid var(--border-color);
            cursor: pointer;
            user-select: none;
        }

        .fi-card-toggle:hover {
            background: var(--navy-light);
        }

        .fi-card-toggle-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--accent-gold);
        }

        .fi-card-toggle-label svg {
            width: 16px;
            height: 16px;
            stroke: currentColor;
            fill: none;
        }

        .fi-card-toggle-arrow {
            transition: transform 0.2s;
        }

        .fi-card-toggle.open .fi-card-toggle-arrow {
            transform: rotate(180deg);
        }

        .fi-card-panel {
            display: none;
            background: linear-gradient(135deg, #0a1628 0%, #1a2d4a 100%);
            border-top: 1px solid var(--border-color);
            padding: 12px;
            max-height: 500px;
            overflow-y: auto;
        }

        .fi-card-panel.open {
            display: block;
        }

        .fi-card-form {
            background: linear-gradient(180deg, #0d1f3c 0%, #132744 100%);
            border: 1px solid rgba(100, 160, 255, 0.3);
            border-radius: 8px;
            font-family: 'Inter', -apple-system, sans-serif;
            font-size: 11px;
            color: #e0e8f4;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.05);
            overflow: hidden;
        }

        .fi-row {
            display: flex;
            border-bottom: 1px solid rgba(100, 160, 255, 0.15);
        }

        .fi-row:last-child {
            border-bottom: none;
        }

        .fi-cell {
            border-right: 1px solid rgba(100, 160, 255, 0.15);
            padding: 6px 8px;
            display: flex;
            flex-direction: column;
            min-height: 32px;
            background: rgba(255, 255, 255, 0.02);
        }

        .fi-cell:last-child {
            border-right: none;
        }

        .fi-cell:hover {
            background: rgba(100, 160, 255, 0.05);
        }

        .fi-cell label {
            font-size: 9px;
            text-transform: uppercase;
            font-weight: 600;
            color: #64a0ff;
            margin-bottom: 2px;
            white-space: nowrap;
            letter-spacing: 0.5px;
        }

        .fi-cell input,
        .fi-cell textarea {
            border: none;
            background: transparent;
            font-family: 'Inter', -apple-system, sans-serif;
            font-size: 12px;
            color: #fff;
            width: 100%;
            flex: 1;
            padding: 2px 0;
            outline: none;
            min-height: 0;
        }

        .fi-cell input::placeholder,
        .fi-cell textarea::placeholder {
            color: rgba(255, 255, 255, 0.3);
        }

        .fi-cell input:focus,
        .fi-cell textarea:focus {
            background: rgba(100, 160, 255, 0.1);
            border-radius: 2px;
        }

        .fi-cell textarea {
            resize: none;
            height: 100%;
        }

        .fi-cell.w8 { flex: 0 0 8%; }
        .fi-cell.w10 { flex: 0 0 10%; }
        .fi-cell.w12 { flex: 0 0 12%; }
        .fi-cell.w15 { flex: 0 0 15%; }
        .fi-cell.w16 { flex: 0 0 16%; }
        .fi-cell.w17 { flex: 0 0 17%; }
        .fi-cell.w20 { flex: 0 0 20%; }
        .fi-cell.w22 { flex: 0 0 22%; }
        .fi-cell.w25 { flex: 0 0 25%; }
        .fi-cell.w28 { flex: 0 0 28%; }
        .fi-cell.w30 { flex: 0 0 30%; }
        .fi-cell.w33 { flex: 0 0 33.33%; }
        .fi-cell.w35 { flex: 0 0 35%; }
        .fi-cell.w40 { flex: 0 0 40%; }
        .fi-cell.w45 { flex: 0 0 45%; }
        .fi-cell.w50 { flex: 0 0 50%; }
        .fi-cell.w60 { flex: 0 0 60%; }
        .fi-cell.w70 { flex: 0 0 70%; }
        .fi-cell.w100 { flex: 0 0 100%; }

        .fi-checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 4px 10px;
            font-size: 10px;
        }

        .fi-checkbox-group label {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 10px;
            font-weight: normal;
            cursor: pointer;
            color: #c0d0e8;
            transition: color 0.2s;
        }

        .fi-checkbox-group label:hover {
            color: #fff;
        }

        .fi-checkbox-group input[type="checkbox"],
        .fi-checkbox-group input[type="radio"] {
            width: 12px;
            height: 12px;
            margin: 0;
            accent-color: #64a0ff;
        }

        .fi-section-header {
            background: linear-gradient(90deg, #1a3a5c 0%, #2a4a6c 50%, #1a3a5c 100%);
            font-weight: 700;
            text-align: center;
            padding: 8px;
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 1px;
            color: #64a0ff;
            border-bottom: 1px solid rgba(100, 160, 255, 0.3);
            border-top: 1px solid rgba(100, 160, 255, 0.3);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .fi-field label {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
        }

        .fi-field input,
        .fi-field select,
        .fi-field textarea {
            background: var(--navy-mid);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 0.4rem 0.5rem;
            color: var(--text-primary);
            font-size: 0.8rem;
            font-family: inherit;
        }

        .fi-field input:focus,
        .fi-field select:focus,
        .fi-field textarea:focus {
            outline: none;
            border-color: var(--tactical-blue);
        }

        .fi-field textarea {
            resize: none;
            min-height: 50px;
        }

        .fi-section-title {
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--tactical-blue);
            margin: 0.75rem 0 0.5rem 0;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border-color);
            grid-column: span 3;
        }

        .fi-section-title:first-child {
            margin-top: 0;
            padding-top: 0;
            border-top: none;
        }

        /* Split Input Area */
        .split-input-area {
            padding: 1rem 1.25rem;
            background: var(--navy-deep);
            border-top: 1px solid var(--border-color);
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
        }

        .input-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 0.35rem;
        }

        .input-label svg {
            width: 12px;
            height: 12px;
            stroke: currentColor;
            fill: none;
        }

        .input-label.say-label { color: var(--tactical-blue); }
        .input-label.do-label { color: var(--accent-gold); }
        .input-label.radio-label { color: var(--success); }

        .split-input {
            background: var(--navy-mid);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 0.6rem 0.75rem;
            color: var(--text-primary);
            font-size: 0.9rem;
            font-family: inherit;
            resize: none;
            min-height: 60px;
            transition: border-color 0.2s;
        }

        .split-input::placeholder {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .split-input:focus {
            outline: none;
            border-color: var(--tactical-blue);
        }

        .split-input.say-input:focus { border-color: var(--tactical-blue); }
        .split-input.do-input:focus { border-color: var(--accent-gold); }
        .split-input.radio-input:focus { border-color: var(--success); }

        .input-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .response-timer {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .timer-value {
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 1.1rem;
            color: var(--text-secondary);
            min-width: 50px;
        }

        .timer-value.active {
            color: var(--warning);
            animation: pulse 1s infinite;
        }

        .submit-action {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .submit-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.65rem 1.25rem;
            background: var(--accent-gold);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--navy-deep);
            transition: all 0.2s;
        }

        .submit-btn:hover:not(:disabled) {
            background: var(--accent-gold-bright);
            transform: translateY(-1px);
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .submit-btn svg {
            width: 16px;
            height: 16px;
            fill: var(--navy-deep);
        }

        /* Scenario Selection */
        .scenario-select {
            padding: 2rem;
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .scenario-select-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .scenario-select-header h2 {
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
        }

        .scenario-select-header p {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        .select-section {
            margin-bottom: 1.5rem;
        }

        .select-label {
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--accent-gold);
            margin-bottom: 0.75rem;
            display: block;
        }

        .scenario-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            flex: 1;
            min-height: 200px;
            max-height: calc(100vh - 350px);
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .scenario-grid::-webkit-scrollbar {
            width: 6px;
        }

        .scenario-grid::-webkit-scrollbar-track {
            background: var(--navy-deep);
            border-radius: 3px;
        }

        .scenario-grid::-webkit-scrollbar-thumb {
            background: var(--tactical-blue);
            border-radius: 3px;
        }

        .scenario-card.random-card {
            grid-column: span 2;
            background: linear-gradient(135deg, var(--navy-deep), var(--navy-light));
            border-style: dashed;
        }

        .scenario-card.random-card .scenario-icon-box {
            background: rgba(201, 162, 39, 0.2);
        }

        .scenario-score {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--navy-light);
            border-radius: 6px;
            padding: 0.25rem 0.5rem;
            font-size: 0.7rem;
            font-family: 'Barlow Condensed', sans-serif;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .scenario-score.no-score {
            color: var(--text-muted);
        }

        .scenario-score.score-low {
            color: var(--error);
            background: rgba(248, 113, 113, 0.15);
        }

        .scenario-score.score-mid {
            color: var(--warning);
            background: rgba(251, 191, 36, 0.15);
        }

        .scenario-score.score-high {
            color: var(--success);
            background: rgba(74, 222, 128, 0.15);
        }

        .scenario-card {
            position: relative;
        }

        .scenario-card {
            background: var(--navy-deep);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            padding: 1rem 1.25rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .scenario-card:hover {
            border-color: var(--tactical-blue);
        }

        .scenario-card.selected {
            border-color: var(--accent-gold);
            background: rgba(201, 162, 39, 0.1);
        }

        .scenario-icon-box {
            width: 48px;
            height: 48px;
            background: rgba(46, 90, 140, 0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .scenario-card.selected .scenario-icon-box {
            background: rgba(201, 162, 39, 0.2);
        }

        .scenario-details h4 {
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
        }

        .scenario-details p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin: 0;
        }

        .difficulty-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.5rem;
        }

        .difficulty-card {
            background: var(--navy-deep);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .difficulty-card:hover {
            border-color: var(--tactical-blue);
        }

        .difficulty-card.selected {
            border-color: var(--accent-gold);
            background: rgba(201, 162, 39, 0.1);
        }

        .difficulty-card.easy .difficulty-icon { color: var(--success); }
        .difficulty-card.medium .difficulty-icon { color: var(--warning); }
        .difficulty-card.hard .difficulty-icon { color: var(--error); }

        .difficulty-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .difficulty-card h4 {
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 1rem;
            margin-bottom: 0.25rem;
        }

        .difficulty-card p {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin: 0;
        }

        .start-scenario-btn {
            width: 100%;
            padding: 1rem;
            margin-top: 1rem;
            font-size: 1.1rem;
            justify-content: center;
        }

        @media (max-width: 900px) {
            .hero-content {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .hero-text {
                order: 1;
            }

            .demo-preview {
                order: 2;
            }

            .hero-subtitle {
                margin-left: auto;
                margin-right: auto;
            }

            .hero-cta {
                justify-content: center;
            }

            .hero-stats {
                justify-content: center;
            }

            nav {
                display: none;
            }
        }

        @media (max-width: 600px) {
            /* Prevent horizontal scroll - aggressive fix */
            html, body {
                overflow-x: hidden !important;
                max-width: 100vw !important;
                width: 100% !important;
            }

            *, *::before, *::after {
                max-width: 100vw;
                box-sizing: border-box;
            }

            .grid-bg {
                display: none;
            }

            .content-wrapper,
            .modal,
            .modal-overlay,
            section,
            .demo-chat,
            .fi-card-form,
            .fi-card-panel,
            .scenario-selection,
            .split-input-area {
                overflow-x: hidden !important;
                max-width: 100vw !important;
                width: 100% !important;
            }

            .hero {
                padding: 5rem 0.75rem 2rem;
                overflow-x: hidden !important;
            }

            .hero-content {
                gap: 1.5rem;
                padding: 0;
            }

            .demo-preview {
                width: 100% !important;
                max-width: 100% !important;
                overflow: hidden !important;
                padding: 0 !important;
                margin: 0 !important;
            }

            .demo-preview .chat-window {
                width: 100% !important;
                max-width: 100% !important;
            }

            /* Hero demo chat elements */
            .demo-preview .chat-header {
                padding: 0.5rem;
            }

            .demo-preview .scenario-info h3 {
                font-size: 0.7rem;
            }

            .demo-preview .scenario-info span {
                font-size: 0.6rem;
            }

            .demo-preview .chat-messages {
                padding: 0.5rem;
                min-height: 200px;
            }

            .demo-preview .message {
                font-size: 0.75rem;
                padding: 0.4rem 0.6rem;
            }

            .demo-preview .message-label {
                font-size: 0.6rem;
            }

            .hint-panel {
                margin-top: 0.25rem;
                padding-top: 0.5rem;
            }

            .hint-box {
                padding: 0.5rem;
                gap: 0.5rem;
                flex-direction: column;
            }

            .hint-icon {
                width: 16px !important;
                height: 16px !important;
            }

            .hint-content {
                font-size: 0.7rem;
                word-wrap: break-word;
                overflow-wrap: break-word;
            }

            .chat-input {
                padding: 0.5rem;
                gap: 0.5rem;
            }

            .chat-input input {
                font-size: 0.8rem;
                padding: 0.5rem;
            }

            .chat-input button {
                padding: 0.5rem 0.75rem;
                font-size: 0.75rem;
            }

            .hero-stats {
                flex-direction: column;
                gap: 1.5rem;
                align-items: center;
            }

            .stat {
                text-align: center;
            }

            .pricing-card {
                padding: 2rem 1.5rem;
            }

            .input-row {
                grid-template-columns: 1fr;
            }

            .split-input {
                min-height: 50px;
            }

            /* Modal mobile styles */
            .modal {
                border-radius: 0;
                padding: 0;
                width: 100vw;
                max-width: 100vw;
                margin-top: 0 !important;
                top: 0 !important;
            }

            .modal-header {
                padding: 1rem;
                padding-top: calc(env(safe-area-inset-top, 20px) + 1rem) !important;
                padding-right: 3rem;
                flex-wrap: wrap;
                gap: 0.5rem;
                position: relative;
            }

            .modal-header h2 {
                font-size: 1.4rem;
                width: 100%;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .modal-header p {
                font-size: 1rem;
            }

            .scenario-timer {
                font-size: 1rem;
            }

            .modal-close {
                position: fixed;
                top: calc(env(safe-area-inset-top, 20px) + 0.75rem);
                right: 0.75rem;
                width: 36px;
                height: 36px;
                z-index: 1001;
            }

            /* Scenario selection mobile */
            .scenario-selection {
                padding: 0.5rem;
                overflow-x: hidden !important;
                width: 100% !important;
                max-width: 100% !important;
                box-sizing: border-box !important;
            }

            .scenario-categories {
                gap: 1rem;
                width: 100%;
            }

            .category-title {
                font-size: 1rem;
                margin-bottom: 0.5rem;
            }

            .scenario-grid {
                display: flex !important;
                flex-direction: column !important;
                gap: 0.5rem !important;
                width: 100% !important;
                max-width: 100% !important;
                box-sizing: border-box !important;
            }

            .scenario-card {
                padding: 0.75rem 1rem !important;
                min-height: auto !important;
                width: 100% !important;
                max-width: 100% !important;
                box-sizing: border-box !important;
                gap: 0.75rem !important;
                flex-direction: row !important;
                align-items: center !important;
                text-align: left !important;
            }

            .scenario-icon-box {
                width: 44px !important;
                height: 44px !important;
                font-size: 1.5rem !important;
                flex-shrink: 0 !important;
            }

            .scenario-details {
                min-width: 0 !important;
                flex: 1 !important;
                overflow: hidden !important;
            }

            .scenario-details h4 {
                font-size: 1rem !important;
                line-height: 1.3 !important;
                margin-bottom: 0.15rem !important;
                white-space: nowrap !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
            }

            .scenario-details p {
                display: block !important;
                font-size: 0.8rem !important;
                color: var(--text-secondary) !important;
                white-space: nowrap !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
            }

            .scenario-score {
                font-size: 0.75rem !important;
                padding: 4px 8px !important;
                position: absolute !important;
                top: 8px !important;
                right: 8px !important;
            }

            /* Difficulty selector mobile */
            .difficulty-selector {
                padding: 0.5rem;
                flex-direction: column;
                align-items: stretch;
                gap: 0.4rem;
                width: 100% !important;
                max-width: 100% !important;
                box-sizing: border-box !important;
            }

            .difficulty-selector label {
                font-size: 0.65rem;
                text-align: center;
            }

            .difficulty-options {
                width: 100% !important;
                display: grid;
                grid-template-columns: repeat(5, 1fr);
                gap: 0.2rem;
                box-sizing: border-box;
            }

            .difficulty-btn {
                padding: 0.4rem 0.1rem;
                font-size: 0.55rem;
                text-align: center;
                white-space: nowrap;
            }

            /* Difficulty grid mobile - the cards with icons */
            .difficulty-grid {
                display: grid !important;
                grid-template-columns: repeat(5, 1fr) !important;
                gap: 0.35rem !important;
                width: 100% !important;
                max-width: 100% !important;
                box-sizing: border-box !important;
                padding: 0 !important;
                margin: 0 !important;
            }

            .difficulty-card {
                padding: 0.5rem 0.2rem !important;
                min-width: 0 !important;
                width: 100% !important;
                box-sizing: border-box !important;
                overflow: hidden !important;
            }

            .difficulty-card .difficulty-icon {
                font-size: 1.4rem !important;
                margin-bottom: 0.25rem !important;
            }

            .difficulty-card h4 {
                font-size: 0.7rem !important;
                margin-bottom: 0 !important;
                white-space: nowrap !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
            }

            .difficulty-card p {
                display: none !important;
            }

            .select-section {
                width: 100% !important;
                max-width: 100% !important;
                box-sizing: border-box !important;
                padding: 0.75rem !important;
                overflow: hidden !important;
            }

            .select-label {
                font-size: 1rem !important;
                margin-bottom: 0.5rem !important;
                display: block !important;
            }

            /* Chat area mobile */
            .chat-window {
                border-radius: 8px;
                max-width: 100%;
            }

            .chat-header {
                padding: 0.5rem 0.75rem;
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .chat-scenario {
                gap: 0.5rem;
                flex: 1;
                min-width: 0;
            }

            .scenario-icon {
                width: 28px;
                height: 28px;
                flex-shrink: 0;
            }

            .scenario-icon svg {
                width: 16px;
                height: 16px;
            }

            .scenario-info {
                min-width: 0;
                overflow: hidden;
            }

            .scenario-info h3 {
                font-size: 0.75rem;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .scenario-info span {
                font-size: 0.65rem;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                display: block;
            }

            .mode-badge {
                padding: 0.25rem 0.5rem;
                font-size: 0.6rem;
                flex-shrink: 0;
            }

            .demo-chat {
                min-height: auto;
                overflow-x: hidden !important;
                max-width: 100% !important;
            }

            .chat-messages {
                padding: 0.5rem;
                max-height: 200px;
            }

            .message {
                max-width: 90%;
                padding: 0.5rem 0.6rem;
                font-size: 0.8rem;
                word-wrap: break-word;
                overflow-wrap: break-word;
            }

            .message-content {
                word-wrap: break-word;
                overflow-wrap: break-word;
            }

            /* Observation panel mobile */
            .observation-panel {
                padding: 0.5rem;
            }

            .observation-panel h4 {
                font-size: 0.65rem;
            }

            .observation-list {
                gap: 0.25rem;
                flex-wrap: wrap;
            }

            .observation-item {
                font-size: 0.65rem;
                padding: 0.2rem 0.4rem;
            }

            /* Split input mobile */
            .split-input-area {
                padding: 0.5rem;
            }

            .input-row {
                gap: 0.4rem;
            }

            .input-label {
                font-size: 0.6rem;
            }

            .input-label svg {
                width: 10px;
                height: 10px;
            }

            .split-input {
                font-size: 0.8rem;
                padding: 0.4rem;
                min-height: 40px;
            }

            .send-btn {
                padding: 0.6rem 1rem;
                font-size: 0.75rem;
            }

            .send-btn svg {
                width: 14px;
                height: 14px;
            }

            /* FI Card mobile - complete redesign for mobile */
            .fi-card-toggle {
                padding: 0.5rem 0.75rem;
            }

            .fi-card-toggle-label {
                font-size: 0.7rem;
            }

            .fi-card-panel {
                padding: 4px;
                max-height: 350px;
                overflow-x: hidden;
            }

            .fi-card-form {
                font-size: 9px;
                overflow-x: hidden;
            }

            .fi-row {
                flex-wrap: wrap;
            }

            /* All cells stack vertically on mobile */
            .fi-cell {
                min-height: 24px;
                padding: 3px 5px;
                flex: 1 1 48% !important;
                max-width: 50%;
                box-sizing: border-box;
                border-right: 1px solid rgba(100, 160, 255, 0.15);
                border-bottom: 1px solid rgba(100, 160, 255, 0.15);
            }

            .fi-cell:nth-child(2n) {
                border-right: none;
            }

            /* Full width cells */
            .fi-cell.w100,
            .fi-cell.w70,
            .fi-cell.w60,
            .fi-cell.w50,
            .fi-cell.w45,
            .fi-cell.w40,
            .fi-cell.w35,
            .fi-cell.w30,
            .fi-cell.w28,
            .fi-cell.w25 {
                flex: 1 1 100% !important;
                max-width: 100%;
                border-right: none;
            }

            .fi-cell label {
                font-size: 7px;
                margin-bottom: 1px;
            }

            .fi-cell input,
            .fi-cell textarea {
                font-size: 10px;
            }

            /* Checkbox groups - vertical stack */
            .fi-checkbox-group {
                display: flex;
                flex-direction: column;
                gap: 1px;
                font-size: 8px;
            }

            .fi-checkbox-group label {
                font-size: 7px;
                padding: 1px 0;
            }

            .fi-checkbox-group input[type="checkbox"],
            .fi-checkbox-group input[type="radio"] {
                width: 9px;
                height: 9px;
            }

            .fi-section-header {
                font-size: 8px;
                padding: 4px;
            }

            /* Features section mobile */
            .features-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .feature-card {
                padding: 1.25rem;
            }

            /* General mobile typography */
            h1 {
                font-size: 1.75rem;
            }

            h2 {
                font-size: 1.4rem;
            }

            .section-header h2 {
                font-size: 1.4rem;
            }

            .section-header p {
                font-size: 0.85rem;
            }
        }

        /* Extra small devices */
        @media (max-width: 380px) {
            .scenario-card {
                padding: 0.6rem 0.75rem !important;
            }

            .scenario-icon-box {
                width: 36px !important;
                height: 36px !important;
                font-size: 1.2rem !important;
            }

            .scenario-details h4 {
                font-size: 0.9rem !important;
            }

            .scenario-details p {
                font-size: 0.7rem !important;
            }

            .difficulty-grid {
                gap: 0.25rem !important;
            }

            .difficulty-card {
                padding: 0.4rem 0.15rem !important;
            }

            .difficulty-card h4 {
                font-size: 0.6rem !important;
            }

            .difficulty-card .difficulty-icon {
                font-size: 1.2rem !important;
            }

            .fi-cell {
                flex: 1 1 100% !important;
                max-width: 100%;
                border-right: none;
            }

            .chat-messages {
                max-height: 180px;
            }

            h1 {
                font-size: 1.5rem;
            }

            .message {
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="grid-bg"></div>

    <div class="content-wrapper">
        <header>
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M12 2L3 7v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-9-5z"/>
                        </svg>
                    </div>
                    <span class="logo-text">BLUE<span>SHIELD</span> AI</span>
                </div>
                <nav>
                    <a href="#features">Features</a>
                    <a href="#pricing">Pricing</a>
                    <button class="btn btn-outline" id="nav-demo-btn">Try Demo</button>
                </nav>
            </div>
        </header>

        <section class="hero">
            <div class="hero-content">
                <div class="hero-text">
                    <div class="badge">
                        <span class="badge-dot"></span>
                        Now Available for Arizona Law Enforcement
                    </div>
                    <h1>Train Smarter with <span>AI-Powered</span> Scenarios</h1>
                    <p class="hero-subtitle">
                        Practice real-world situations and get instant feedback based on Arizona Revised Statutes. Build confidence before you're in the field.
                    </p>
                    <div class="hero-cta">
                        <button class="btn btn-primary btn-large" id="hero-demo-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <polygon points="5,3 19,12 5,21"/>
                            </svg>
                            Try Demo
                        </button>
                        <a href="#pricing" class="btn btn-outline btn-large">View Pricing</a>
                    </div>
                    <div class="hero-stats">
                        <div class="stat">
                            <div class="stat-value">50+</div>
                            <div class="stat-label">Scenarios</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">ARS</div>
                            <div class="stat-label">Based</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">24/7</div>
                            <div class="stat-label">Available</div>
                        </div>
                    </div>
                </div>

                <div class="demo-preview">
                    <div class="chat-window">
                        <div class="chat-header">
                            <div class="chat-scenario">
                                <div class="scenario-icon">
                                    <svg viewBox="0 0 24 24" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"/>
                                        <path d="M12 6v6l4 2"/>
                                    </svg>
                                </div>
                                <div class="scenario-info">
                                    <h3>Traffic Stop: Suspected DUI</h3>
                                    <span>State Route 87, 11:42 PM</span>
                                </div>
                            </div>
                            <span class="mode-badge">Training Mode</span>
                        </div>
                        <div class="chat-messages">
                            <div class="message message-system">
                                <div class="message-content">
                                    Vehicle pulled over. Driver shows signs of intoxication: bloodshot eyes, odor of alcohol, slurred speech.
                                </div>
                            </div>
                            <div class="message message-subject">
                                <div class="message-label">Subject</div>
                                <div class="message-content">
                                    "What's the problem, officer? I wasn't doing anything wrong. I only had a couple beers with dinner."
                                </div>
                            </div>
                            <div class="message message-officer">
                                <div class="message-label">You</div>
                                <div class="message-content">
                                    "License and registration, please. Have you been drinking tonight?"
                                </div>
                            </div>
                            <div class="message message-subject">
                                <div class="message-label">Subject</div>
                                <div class="message-content">
                                    "Yeah, like I said, just a couple beers. Look, can you just give me a warning? I'm almost home."
                                </div>
                            </div>
                            <div class="hint-panel">
                                <div class="hint-box">
                                    <svg class="hint-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"/>
                                        <path d="M12 16v-4M12 8h.01"/>
                                    </svg>
                                    <div class="hint-content">
                                        <strong>Training Hint</strong>
                                        Consider requesting field sobriety tests. Under ARS 28-1321, you have implied consent authority. Document all observations.
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="chat-input">
                            <input type="text" placeholder="Type your response..." disabled>
                            <button class="send-btn" disabled>
                                <svg viewBox="0 0 24 24">
                                    <path d="M2 21l21-9L2 3v7l15 2-15 2v7z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="features" id="features">
            <div class="section-header">
                <div class="section-label">Capabilities</div>
                <h2 class="section-title">Built for Real-World Readiness</h2>
                <p class="section-subtitle">Every scenario grounded in actual Arizona law, designed by training professionals.</p>
            </div>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                        </svg>
                    </div>
                    <h3>Scenario-Based Training</h3>
                    <p>Interactive conversations with AI subjects across traffic stops, domestic calls, mental health crises, and more.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                        </svg>
                    </div>
                    <h3>ARS Legal Framework</h3>
                    <p>Every response evaluated against Arizona Revised Statutes. Know exactly which sections apply to your actions.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <svg viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 16v-4M12 8h.01"/>
                        </svg>
                    </div>
                    <h3>Real-Time Hints</h3>
                    <p>Training mode provides contextual legal guidance as you work through scenarios. Learn while you practice.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                        </svg>
                    </div>
                    <h3>Detailed Debriefs</h3>
                    <p>Comprehensive post-scenario analysis highlighting what you did right, what to improve, and relevant case law.</p>
                </div>
            </div>
        </section>

        <section class="pricing" id="pricing">
            <div class="section-header">
                <div class="section-label">Pricing</div>
                <h2 class="section-title">Start Training Today</h2>
                <p class="section-subtitle">Limited-time offer for early adopters.</p>
            </div>
            <div class="pricing-card">
                <div class="promo-banner">Launch Deal</div>
                <h3 class="pricing-title">Officer License</h3>
                <p class="pricing-subtitle">Full access to all scenarios and features</p>
                <div class="price">
                    <span class="price-amount">$20</span>
                    <span class="price-period">/month</span>
                </div>
                <p class="price-note">Pay for 1 month, get 5 months FREE</p>
                <div class="pricing-features">
                    <div class="pricing-feature">
                        <div class="check-icon">
                            <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                        </div>
                        <span>50+ training scenarios</span>
                    </div>
                    <div class="pricing-feature">
                        <div class="check-icon">
                            <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                        </div>
                        <span>Training mode with real-time hints</span>
                    </div>
                    <div class="pricing-feature">
                        <div class="check-icon">
                            <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                        </div>
                        <span>Test mode for self-assessment</span>
                    </div>
                    <div class="pricing-feature">
                        <div class="check-icon">
                            <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                        </div>
                        <span>Detailed debrief reports</span>
                    </div>
                    <div class="pricing-feature">
                        <div class="check-icon">
                            <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                        </div>
                        <span>Full ARS Title 13 coverage</span>
                    </div>
                </div>
                <button class="btn btn-primary btn-stripe" id="checkout-btn">
                    Get 6 Months for $20
                </button>
            </div>
        </section>

        <footer>
            <div class="footer-content">
                <div class="footer-logo">
                    <div class="logo-icon" style="width: 32px; height: 32px;">
                        <svg viewBox="0 0 24 24" style="width: 18px; height: 18px;">
                            <path d="M12 2L3 7v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-9-5z"/>
                        </svg>
                    </div>
                    <span class="logo-text">BLUE<span>SHIELD</span> AI</span>
                </div>
                <div class="footer-links">
                    <a href="#">Contact</a>
                    <a href="#">Privacy Policy</a>
                    <a href="#">Terms of Service</a>
                </div>
                <p class="footer-disclaimer">
                    BlueShield AI is a training tool and does not constitute legal advice. All scenarios are for educational purposes only.
                    Users should consult with their department's legal counsel for official guidance.
                    Not affiliated with or endorsed by any government agency.
                </p>
            </div>
        </footer>
    </div>

    <!-- Demo Modal -->
    <div class="modal-overlay" id="demo-modal">
        <div class="modal">
            <button class="modal-close" id="modal-close-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            </button>

            <!-- Scenario Selection -->
            <div class="scenario-select" id="scenario-select-section">
                <div class="scenario-select-header">
                    <h2>Select Training Scenario</h2>
                    <p>Choose a scenario and difficulty level to begin</p>
                </div>

                <div class="select-section">
                    <span class="select-label">Scenario Type</span>
                    <div class="scenario-grid" id="scenario-grid">
                        <!-- Random/Unknown -->
                        <div class="scenario-card random-card" data-scenario="random">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Unknown Scenario</h4>
                                <p>Test your adaptability - scenario revealed on arrival</p>
                            </div>
                        </div>
                        <!-- Traffic -->
                        <div class="scenario-card selected" data-scenario="dui">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Traffic Stop - DUI</h4>
                                <p>Suspected impaired driver</p>
                            </div>
                        </div>
                        <div class="scenario-card" data-scenario="traffic_warrant">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Traffic Stop - Warrant</h4>
                                <p>Driver has outstanding warrant</p>
                            </div>
                        </div>
                        <div class="scenario-card" data-scenario="traffic_drugs">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Traffic Stop - Narcotics</h4>
                                <p>Suspected drug possession</p>
                            </div>
                        </div>
                        <div class="scenario-card" data-scenario="traffic_suspended">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Suspended License</h4>
                                <p>Driver with suspended license</p>
                            </div>
                        </div>
                        <!-- Domestic/Violence -->
                        <div class="scenario-card" data-scenario="domestic">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Domestic Violence</h4>
                                <p>Yelling and breaking glass reported</p>
                            </div>
                        </div>
                        <div class="scenario-card" data-scenario="domestic_weapons">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>DV - Weapons Involved</h4>
                                <p>Domestic with knife/weapon mentioned</p>
                            </div>
                        </div>
                        <div class="scenario-card" data-scenario="assault">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Assault in Progress</h4>
                                <p>Physical altercation between parties</p>
                            </div>
                        </div>
                        <div class="scenario-card" data-scenario="threats">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Threatening/Intimidation</h4>
                                <p>Verbal threats made against victim</p>
                            </div>
                        </div>
                        <!-- Property Crimes -->
                        <div class="scenario-card" data-scenario="shoplifting">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Shoplifting</h4>
                                <p>LP detained suspect at store</p>
                            </div>
                        </div>
                        <div class="scenario-card" data-scenario="burglary">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Burglary in Progress</h4>
                                <p>Suspect inside residence/business</p>
                            </div>
                        </div>
                        <div class="scenario-card" data-scenario="theft">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Theft Report</h4>
                                <p>Victim reporting stolen property</p>
                            </div>
                        </div>
                        <div class="scenario-card" data-scenario="vehicle_theft">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Vehicle Theft</h4>
                                <p>Stolen vehicle recovered with occupant</p>
                            </div>
                        </div>
                        <!-- Trespass/Disturbance -->
                        <div class="scenario-card" data-scenario="trespass">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Criminal Trespass</h4>
                                <p>Refusing to leave property</p>
                            </div>
                        </div>
                        <div class="scenario-card" data-scenario="disturbance">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Disorderly Conduct</h4>
                                <p>Disturbance at bar/public place</p>
                            </div>
                        </div>
                        <div class="scenario-card" data-scenario="noise">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Noise Complaint</h4>
                                <p>Loud party, music complaints</p>
                            </div>
                        </div>
                        <div class="scenario-card" data-scenario="loitering">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Loitering/Panhandling</h4>
                                <p>Aggressive panhandler at business</p>
                            </div>
                        </div>
                        <!-- Civil Disputes -->
                        <div class="scenario-card" data-scenario="civil_property">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Civil - Property Dispute</h4>
                                <p>Neighbors arguing over property line</p>
                            </div>
                        </div>
                        <div class="scenario-card" data-scenario="civil_custody">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Civil - Custody Exchange</h4>
                                <p>Disputed child custody exchange</p>
                            </div>
                        </div>
                        <div class="scenario-card" data-scenario="civil_landlord">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Civil - Landlord/Tenant</h4>
                                <p>Eviction or lockout dispute</p>
                            </div>
                        </div>
                        <div class="scenario-card" data-scenario="civil_repo">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Civil - Repossession</h4>
                                <p>Vehicle repo standby request</p>
                            </div>
                        </div>
                        <div class="scenario-card" data-scenario="civil_business">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Civil - Business Dispute</h4>
                                <p>Customer/business disagreement</p>
                            </div>
                        </div>
                        <!-- Mental Health/Welfare -->
                        <div class="scenario-card" data-scenario="mental_crisis">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Mental Health Crisis</h4>
                                <p>Person in psychological distress</p>
                            </div>
                        </div>
                        <div class="scenario-card" data-scenario="welfare_check">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Welfare Check</h4>
                                <p>Family hasn't heard from resident</p>
                            </div>
                        </div>
                        <div class="scenario-card" data-scenario="suicide_threat">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Suicide Threat</h4>
                                <p>Person threatening self-harm</p>
                            </div>
                        </div>
                        <div class="scenario-card" data-scenario="intoxicated">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Intoxicated Person</h4>
                                <p>Passed out/incapacitated in public</p>
                            </div>
                        </div>
                        <!-- Other -->
                        <div class="scenario-card" data-scenario="suspicious">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Suspicious Person</h4>
                                <p>Subject casing neighborhood</p>
                            </div>
                        </div>
                        <div class="scenario-card" data-scenario="alarm">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Alarm Response</h4>
                                <p>Burglar alarm at business</p>
                            </div>
                        </div>
                        <div class="scenario-card" data-scenario="harassment">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Harassment</h4>
                                <p>Ongoing harassment complaint</p>
                            </div>
                        </div>
                        <div class="scenario-card" data-scenario="stalking">
                            <div class="scenario-icon-box"></div>
                            <div class="scenario-details">
                                <h4>Stalking</h4>
                                <p>Victim reports being followed</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="select-section">
                    <span class="select-label">Difficulty Level</span>
                    <div class="difficulty-grid" id="difficulty-grid">
                        <div class="difficulty-card" data-difficulty="trainee">
                            <div class="difficulty-icon"></div>
                            <h4>Trainee</h4>
                            <p>Very cooperative</p>
                        </div>
                        <div class="difficulty-card selected" data-difficulty="easy">
                            <div class="difficulty-icon"></div>
                            <h4>Rookie</h4>
                            <p>Mostly compliant</p>
                        </div>
                        <div class="difficulty-card" data-difficulty="medium">
                            <div class="difficulty-icon"></div>
                            <h4>Standard</h4>
                            <p>Evasive</p>
                        </div>
                        <div class="difficulty-card" data-difficulty="hard">
                            <div class="difficulty-icon"></div>
                            <h4>Veteran</h4>
                            <p>Resistant</p>
                        </div>
                        <div class="difficulty-card" data-difficulty="expert">
                            <div class="difficulty-icon"></div>
                            <h4>Expert</h4>
                            <p>Hostile/volatile</p>
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary start-scenario-btn" id="start-scenario-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <polygon points="5,3 19,12 5,21"/>
                    </svg>
                    Start Scenario
                </button>
            </div>

            <div class="demo-chat" id="demo-chat-section" style="display: none;">
                <div class="chat-header">
                    <div class="chat-scenario">
                        <div class="scenario-icon">
                            <svg viewBox="0 0 24 24" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 6v6l4 2"/>
                            </svg>
                        </div>
                        <div class="scenario-info">
                            <h3>DEMO: Traffic Stop - Suspected DUI</h3>
                            <span>State Route 87, 11:42 PM</span>
                        </div>
                    </div>
                    <span class="mode-badge">Training Mode</span>
                </div>
                <!-- Observation Panel -->
                <div class="observation-panel" id="observation-panel">
                    <div class="observation-header">
                        <svg viewBox="0 0 24 24" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M12 1v6m0 6v10M1 12h6m6 0h10"/>
                        </svg>
                        <span>Current Observations</span>
                    </div>
                    <div class="observation-list" id="observation-list">
                        <span class="observation-tag warning">
                            <svg viewBox="0 0 24 24" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                            Bloodshot eyes
                        </span>
                        <span class="observation-tag critical">
                            <svg viewBox="0 0 24 24" stroke-width="2"><path d="M12 19l-7-7 1.41-1.41L12 16.17l11.59-11.58L25 6z"/></svg>
                            Strong odor of alcohol
                        </span>
                        <span class="observation-tag warning">
                            <svg viewBox="0 0 24 24" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                            Slurred speech
                        </span>
                        <span class="observation-tag">
                            <svg viewBox="0 0 24 24" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                            Weaving between lanes
                        </span>
                    </div>
                </div>
                <div class="subject-panel" id="subject-panel">
                    <div class="subject-portrait mood-nervous" id="subject-portrait">
                        <span class="portrait-face" id="portrait-face"></span>
                    </div>
                    <div class="subject-info">
                        <div class="subject-name">Unknown Male</div>
                        <div class="subject-mood mood-nervous" id="subject-mood-badge">
                            <span class="mood-dot"></span>
                            <span id="mood-text">Nervous</span>
                        </div>
                        <div class="subject-action" id="subject-action">Gripping steering wheel tightly</div>
                    </div>
                </div>
                <div class="chat-messages" id="demo-messages"></div>

                <!-- FI Card (36 Card) -->
                <div class="fi-card-toggle" id="fi-card-toggle">
                    <div class="fi-card-toggle-label">
                        <svg viewBox="0 0 24 24" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                            <polyline points="10 9 9 9 8 9"/>
                        </svg>
                        FI Card (36 Card)
                    </div>
                    <svg class="fi-card-toggle-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"/>
                    </svg>
                </div>
                <div class="fi-card-panel" id="fi-card-panel">
                    <div class="fi-card-form">
                        <!-- Row 1: Date, Time, Serial#, Officer, Squad, Inc -->
                        <div class="fi-row">
                            <div class="fi-cell w12"><label>Date *</label><input type="text" id="fi-date"></div>
                            <div class="fi-cell w12"><label>Time *</label><input type="text" id="fi-time"></div>
                            <div class="fi-cell w15"><label>Serial # *</label><input type="text" id="fi-serial"></div>
                            <div class="fi-cell w30"><label>Officer Name</label><input type="text" id="fi-officer"></div>
                            <div class="fi-cell w15"><label>Squad</label><input type="text" id="fi-squad"></div>
                            <div class="fi-cell w16"><label>Inc. #</label><input type="text" id="fi-inc"></div>
                        </div>
                        <!-- Call Details Section -->
                        <div class="fi-section-header">Call Details</div>
                        <div class="fi-row">
                            <div class="fi-cell w25"><label>Call Type / Nature</label><input type="text" id="fi-call-type"></div>
                            <div class="fi-cell w25"><label>CAD / Call #</label><input type="text" id="fi-cad-number"></div>
                            <div class="fi-cell w15"><label>Dispatched</label><input type="text" id="fi-dispatched"></div>
                            <div class="fi-cell w15"><label>Arrived</label><input type="text" id="fi-arrived"></div>
                            <div class="fi-cell w20"><label>Cleared</label><input type="text" id="fi-cleared"></div>
                        </div>
                        <div class="fi-row">
                            <div class="fi-cell w50"><label>Disposition / How Cleared</label><input type="text" id="fi-disposition"></div>
                            <div class="fi-cell w50"><label>Beat / Zone</label><input type="text" id="fi-beat"></div>
                        </div>
                        <!-- Row 2: Location + Contact Type -->
                        <div class="fi-row">
                            <div class="fi-cell w70"><label>Location of Occurrence *</label><input type="text" id="fi-location"></div>
                            <div class="fi-cell w30">
                                <label>Contact Type</label>
                                <div class="fi-checkbox-group">
                                    <label><input type="radio" name="fi-contact-type" value="1"> 1. Driver</label>
                                    <label><input type="radio" name="fi-contact-type" value="2"> 2. Passenger</label>
                                    <label><input type="radio" name="fi-contact-type" value="3"> 3. Pedestrian</label>
                                    <label><input type="radio" name="fi-contact-type" value="4"> 4. N/A</label>
                                </div>
                            </div>
                        </div>
                        <!-- Row 3: Name -->
                        <div class="fi-row">
                            <div class="fi-cell w40"><label>Last Name</label><input type="text" id="fi-last-name"></div>
                            <div class="fi-cell w40"><label>First Name</label><input type="text" id="fi-first-name"></div>
                            <div class="fi-cell w20"><label>M.I.</label><input type="text" id="fi-middle"></div>
                        </div>
                        <!-- Row 4: Home Address + SSN -->
                        <div class="fi-row">
                            <div class="fi-cell w70"><label>Home Address</label><input type="text" id="fi-address"></div>
                            <div class="fi-cell w30"><label>Social Security Number</label><input type="text" id="fi-ssn"></div>
                        </div>
                        <!-- Row 5: Physical descriptors + DL -->
                        <div class="fi-row">
                            <div class="fi-cell w10"><label>Race</label><input type="text" id="fi-race"></div>
                            <div class="fi-cell w8"><label>Sex</label><input type="text" id="fi-sex"></div>
                            <div class="fi-cell w10"><label>Weight</label><input type="text" id="fi-weight"></div>
                            <div class="fi-cell w10"><label>Height</label><input type="text" id="fi-height"></div>
                            <div class="fi-cell w10"><label>Eyes</label><input type="text" id="fi-eyes"></div>
                            <div class="fi-cell w10"><label>Hair</label><input type="text" id="fi-hair-color"></div>
                            <div class="fi-cell w12"><label>Date of Birth</label><input type="text" id="fi-dob"></div>
                            <div class="fi-cell w22"><label>Driver's License Number</label><input type="text" id="fi-dl"></div>
                            <div class="fi-cell w8"><label>State</label><input type="text" id="fi-dl-state"></div>
                        </div>
                        <!-- Row 6: Business/Occupation + Misc/Clothing -->
                        <div class="fi-row">
                            <div class="fi-cell w60"><label>Business Address/Occupation</label><input type="text" id="fi-occupation"></div>
                            <div class="fi-cell w40"><label>Misc./Clothing</label><input type="text" id="fi-clothing"></div>
                        </div>
                        <!-- Row 7: Gang Affiliation + Phone -->
                        <div class="fi-row">
                            <div class="fi-cell w60"><label>Gang Affiliation</label><input type="text" id="fi-gang"></div>
                            <div class="fi-cell w40"><label>Phone Number</label><input type="text" id="fi-phone"></div>
                        </div>
                        <!-- Row 8: Nickname/Alias full width -->
                        <div class="fi-row">
                            <div class="fi-cell w100"><label>Nickname/Alias</label><input type="text" id="fi-alias"></div>
                        </div>
                        <!-- Row 9: Build, Hair Length, Hair Style, Facial Hair, Complexion, Misc -->
                        <div class="fi-row">
                            <div class="fi-cell w12">
                                <label>Build</label>
                                <div class="fi-checkbox-group">
                                    <label><input type="radio" name="fi-build" value="2"> 2 Thin</label>
                                    <label><input type="radio" name="fi-build" value="3"> 3 Medium</label>
                                    <label><input type="radio" name="fi-build" value="4"> 4 Heavy</label>
                                    <label><input type="radio" name="fi-build" value="5"> 5 Misc.</label>
                                </div>
                            </div>
                            <div class="fi-cell w15">
                                <label>Hair Length</label>
                                <div class="fi-checkbox-group">
                                    <label><input type="radio" name="fi-hair-len" value="3"> 3 Conserv.</label>
                                    <label><input type="radio" name="fi-hair-len" value="4"> 4 Short</label>
                                    <label><input type="radio" name="fi-hair-len" value="5"> 5 Bald/Shaved</label>
                                    <label><input type="radio" name="fi-hair-len" value="6"> 6 Thin</label>
                                    <label><input type="radio" name="fi-hair-len" value="8"> 8 Long</label>
                                </div>
                            </div>
                            <div class="fi-cell w15">
                                <label>Hair Style</label>
                                <div class="fi-checkbox-group">
                                    <label><input type="radio" name="fi-hair-style" value="1"> 1 Afro</label>
                                    <label><input type="radio" name="fi-hair-style" value="4"> 4 Curly</label>
                                    <label><input type="radio" name="fi-hair-style" value="4"> 4 Strght</label>
                                    <label><input type="radio" name="fi-hair-style" value="5"> 5 Braided</label>
                                    <label><input type="radio" name="fi-hair-style" value="8"> 8 Ponytail</label>
                                </div>
                            </div>
                            <div class="fi-cell w15">
                                <label>Facial Hair</label>
                                <div class="fi-checkbox-group">
                                    <label><input type="checkbox" name="fi-facial" value="2"> 2 Beard</label>
                                    <label><input type="checkbox" name="fi-facial" value="3"> 3 Goatee</label>
                                    <label><input type="checkbox" name="fi-facial" value="4"> 4 Moustache</label>
                                    <label><input type="checkbox" name="fi-facial" value="5"> 5 Sideburn</label>
                                    <label><input type="checkbox" name="fi-facial" value="6"> 6 Clean Shaven</label>
                                </div>
                            </div>
                            <div class="fi-cell w15">
                                <label>Complexion</label>
                                <div class="fi-checkbox-group">
                                    <label><input type="radio" name="fi-complex" value="2"> 2 Fair</label>
                                    <label><input type="radio" name="fi-complex" value="4"> 4 Medium</label>
                                    <label><input type="radio" name="fi-complex" value="5"> 5 Dark</label>
                                    <label><input type="radio" name="fi-complex" value="7"> 7 Acne</label>
                                    <label><input type="radio" name="fi-complex" value="9"> 9 Ruddy</label>
                                </div>
                            </div>
                            <div class="fi-cell w28">
                                <label>Misc.</label>
                                <div class="fi-checkbox-group">
                                    <label><input type="checkbox" name="fi-misc" value="1"> 1 Accent</label>
                                    <label><input type="checkbox" name="fi-misc" value="2"> 2 Glasses</label>
                                    <label><input type="checkbox" name="fi-misc" value="3"> 3 Tattoos</label>
                                    <label><input type="checkbox" name="fi-misc" value="4"> 4 Scars</label>
                                    <label><input type="checkbox" name="fi-misc" value="5"> 5 Deformity</label>
                                    <label><input type="checkbox" name="fi-misc" value="99"> 99 Other</label>
                                </div>
                            </div>
                        </div>
                        <!-- Row 10: Vehicle - Plate, Year, State, Make, Style, Model, Color -->
                        <div class="fi-row">
                            <div class="fi-cell w20"><label>Plate Number</label><input type="text" id="fi-plate"></div>
                            <div class="fi-cell w10"><label>Year</label><input type="text" id="fi-veh-year"></div>
                            <div class="fi-cell w10"><label>State</label><input type="text" id="fi-plate-state"></div>
                            <div class="fi-cell w15"><label>Make</label><input type="text" id="fi-veh-make"></div>
                            <div class="fi-cell w15"><label>Style</label><input type="text" id="fi-veh-style"></div>
                            <div class="fi-cell w15"><label>Model</label><input type="text" id="fi-veh-model"></div>
                            <div class="fi-cell w15"><label>Color</label><input type="text" id="fi-veh-color"></div>
                        </div>
                        <!-- Row 11: VIN + Registered Owner + Camper -->
                        <div class="fi-row">
                            <div class="fi-cell w40"><label>Vehicle Identification Number</label><input type="text" id="fi-vin"></div>
                            <div class="fi-cell w45"><label>Registered Owner</label><input type="text" id="fi-reg-owner"></div>
                            <div class="fi-cell w15">
                                <label>Camper</label>
                                <div class="fi-checkbox-group">
                                    <label><input type="checkbox" id="fi-camper"> (x if yes)</label>
                                </div>
                            </div>
                        </div>
                        <!-- Back of Card Section -->
                        <div class="fi-section-header">Additional Subjects / Weapons</div>
                        <!-- Subject #2 -->
                        <div class="fi-row">
                            <div class="fi-cell w15"><label>Subject #2</label></div>
                            <div class="fi-cell w35"><label>Last, First Middle</label><input type="text" id="fi-subj2-name"></div>
                            <div class="fi-cell w10"><label>Race</label><input type="text" id="fi-subj2-race"></div>
                            <div class="fi-cell w10"><label>Sex</label><input type="text" id="fi-subj2-sex"></div>
                            <div class="fi-cell w15"><label>DOB</label><input type="text" id="fi-subj2-dob"></div>
                            <div class="fi-cell w15"><label>SS#</label><input type="text" id="fi-subj2-ssn"></div>
                        </div>
                        <!-- Subject #3 -->
                        <div class="fi-row">
                            <div class="fi-cell w15"><label>Subject #3</label></div>
                            <div class="fi-cell w35"><label>Last, First Middle</label><input type="text" id="fi-subj3-name"></div>
                            <div class="fi-cell w10"><label>Race</label><input type="text" id="fi-subj3-race"></div>
                            <div class="fi-cell w10"><label>Sex</label><input type="text" id="fi-subj3-sex"></div>
                            <div class="fi-cell w15"><label>DOB</label><input type="text" id="fi-subj3-dob"></div>
                            <div class="fi-cell w15"><label>SS#</label><input type="text" id="fi-subj3-ssn"></div>
                        </div>
                        <!-- Weapon -->
                        <div class="fi-row">
                            <div class="fi-cell w25"><label>Weapon Make</label><input type="text" id="fi-weapon-make"></div>
                            <div class="fi-cell w25"><label>Model</label><input type="text" id="fi-weapon-model"></div>
                            <div class="fi-cell w25"><label>Caliber</label><input type="text" id="fi-weapon-caliber"></div>
                            <div class="fi-cell w25"><label>Serial #</label><input type="text" id="fi-weapon-serial"></div>
                        </div>
                        <!-- Narrative Section -->
                        <div class="fi-section-header">Narrative</div>
                        <div class="fi-row">
                            <div class="fi-cell w100" style="min-height: 80px;"><textarea id="fi-narrative" style="min-height: 70px;"></textarea></div>
                        </div>
                        <!-- Email/Social -->
                        <div class="fi-row">
                            <div class="fi-cell w70"><label>Email Address/Social Media Handle</label><input type="text" id="fi-social"></div>
                            <div class="fi-cell w30" style="text-align: right; font-size: 8px; color: #666; justify-content: flex-end;">Field Interview (FI) Card<br>80-36D Rev. 2/14</div>
                        </div>
                        <!-- Call Description - largest field -->
                        <div class="fi-section-header">Call Description</div>
                        <div class="fi-row">
                            <div class="fi-cell w100" style="min-height: 150px;"><textarea id="fi-call-description" style="min-height: 140px;"></textarea></div>
                        </div>
                    </div>
                </div>

                <!-- Split Input Area -->
                <div class="split-input-area">
                    <div class="input-row">
                        <div class="input-group">
                            <label class="input-label say-label">
                                <svg viewBox="0 0 24 24" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                                What I Say
                            </label>
                            <textarea class="split-input say-input" id="input-say" placeholder="License and registration..."></textarea>
                        </div>
                        <div class="input-group">
                            <label class="input-label do-label">
                                <svg viewBox="0 0 24 24" stroke-width="2"><path d="M14.5 10c-.83 0-1.5-.67-1.5-1.5v-5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5v5c0 .83-.67 1.5-1.5 1.5z"/><path d="M20 4l-2 2m-8 8l-6 6"/><path d="M15 15l6 6"/><path d="M3 3l18 18"/></svg>
                                What I Do
                            </label>
                            <textarea class="split-input do-input" id="input-do" placeholder="Shine flashlight in vehicle..."></textarea>
                        </div>
                        <div class="input-group">
                            <label class="input-label radio-label">
                                <svg viewBox="0 0 24 24" stroke-width="2"><path d="M12 20h.01"/><path d="M8.5 16.5a5 5 0 0 1 7 0"/><path d="M5 12.5a10 10 0 0 1 14 0"/><path d="M1.5 8.5a15 15 0 0 1 21 0"/></svg>
                                What I Radio
                            </label>
                            <textarea class="split-input radio-input" id="input-radio" placeholder="Dispatch, I have a 10-55..."></textarea>
                        </div>
                    </div>
                    <div class="input-actions">
                        <div class="response-timer">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                            </svg>
                            Response time: <span class="timer-value" id="response-timer">0.0s</span>
                        </div>
                        <div class="submit-action">
                            <button class="submit-btn" id="demo-send-btn">
                                <svg viewBox="0 0 24 24">
                                    <path d="M2 21l21-9L2 3v7l15 2-15 2v7z"/>
                                </svg>
                                Submit Action
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="demo-debrief" id="demo-debrief-section">
                <div class="debrief-header">
                    <h2>Scenario Debrief</h2>
                    <div class="debrief-score">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                        82/100
                    </div>
                </div>
                <div class="debrief-section">
                    <h3>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                        </svg>
                        Legal Analysis
                    </h3>
                    <div class="debrief-item">
                        <span class="debrief-status status-correct">&#10003;</span>
                        <p><strong>Initial Contact:</strong> Proper identification and inquiry. Under <code>ARS 28-1595</code>, you correctly requested license and registration.</p>
                    </div>
                    <div class="debrief-item">
                        <span class="debrief-status status-correct">&#10003;</span>
                        <p><strong>Reasonable Suspicion:</strong> Observations of bloodshot eyes, odor of alcohol, and slurred speech provide RS for further investigation per <code>ARS 28-1381</code>.</p>
                    </div>
                    <div class="debrief-item">
                        <span class="debrief-status status-issue">!</span>
                        <p><strong>Field Sobriety:</strong> Consider requesting standardized field sobriety tests. Under <code>ARS 28-1321</code> (Implied Consent), refusal can result in license suspension.</p>
                    </div>
                </div>
                <div class="debrief-section">
                    <h3>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 16v-4M12 8h.01"/>
                        </svg>
                        Recommendations
                    </h3>
                    <p>Document all observations in your report: specific indicators of impairment, time of stop, subject statements. If FSTs indicate impairment, you have probable cause for arrest under <code>ARS 28-1381(A)(1)</code> (impaired to the slightest degree) or <code>28-1381(A)(2)</code> (BAC of 0.08 or more).</p>
                </div>
                <div style="text-align: center; margin-top: 1.5rem;">
                    <a href="#pricing" class="btn btn-primary btn-large" id="debrief-cta-btn">
                        Get Full Access
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        (function() {
            'use strict';

            var API_URL = 'https://us-central1-dayta-analytics-sandbox.cloudfunctions.net/blueshield-chat';

            var modal = document.getElementById('demo-modal');
            var scenarioSelectSection = document.getElementById('scenario-select-section');
            var chatSection = document.getElementById('demo-chat-section');
            var debriefSection = document.getElementById('demo-debrief-section');
            var messagesContainer = document.getElementById('demo-messages');
            var inputSay = document.getElementById('input-say');
            var inputDo = document.getElementById('input-do');
            var inputRadio = document.getElementById('input-radio');
            var sendBtn = document.getElementById('demo-send-btn');
            var timerDisplay = document.getElementById('response-timer');
            var scenarioTitle = document.getElementById('scenario-title');
            var scenarioLocation = document.getElementById('scenario-location');

            var messages = [];
            var isLoading = false;
            var demoStarted = false;
            var currentMood = 'nervous';
            var timerInterval = null;
            var timerStart = null;
            var selectedScenario = 'dui';
            var selectedDifficulty = 'easy';
            var scenarioScores = loadScores();

            function loadScores() {
                try {
                    var stored = localStorage.getItem('blueshield_scores');
                    return stored ? JSON.parse(stored) : {};
                } catch (e) {
                    return {};
                }
            }

            function saveScores() {
                try {
                    localStorage.setItem('blueshield_scores', JSON.stringify(scenarioScores));
                } catch (e) {
                    console.error('Could not save scores:', e);
                }
            }

            function updateScenarioScore(scenarioId, score) {
                if (!scenarioScores[scenarioId]) {
                    scenarioScores[scenarioId] = { best: 0, attempts: 0, total: 0 };
                }
                scenarioScores[scenarioId].attempts++;
                scenarioScores[scenarioId].total += score;
                if (score > scenarioScores[scenarioId].best) {
                    scenarioScores[scenarioId].best = score;
                }
                saveScores();
                renderScoreOnCard(scenarioId);
            }

            function renderScoreOnCard(scenarioId) {
                var card = document.querySelector('.scenario-card[data-scenario="' + scenarioId + '"]');
                if (!card || scenarioId === 'random') return;

                var existingScore = card.querySelector('.scenario-score');
                if (existingScore) existingScore.remove();

                var scoreData = scenarioScores[scenarioId];
                var scoreDiv = document.createElement('div');

                if (!scoreData || scoreData.attempts === 0) {
                    scoreDiv.className = 'scenario-score no-score';
                    scoreDiv.textContent = '';
                } else {
                    var best = scoreData.best;
                    var scoreClass = best >= 80 ? 'score-high' : (best >= 60 ? 'score-mid' : 'score-low');
                    scoreDiv.className = 'scenario-score ' + scoreClass;
                    scoreDiv.textContent = ' ' + best;
                }
                card.appendChild(scoreDiv);
            }

            function renderAllScores() {
                // Render scores for all scenario cards
                document.querySelectorAll('.scenario-card[data-scenario]').forEach(function(card) {
                    var scenarioId = card.dataset.scenario;
                    renderScoreOnCard(scenarioId);
                });
            }

            var SCENARIOS = {
                // Traffic
                dui: {
                    title: 'Traffic Stop - DUI',
                    location: 'State Route 87, 11:42 PM',
                    icon: '',
                    intro: 'Vehicle pulled over for weaving between lanes. Driver shows signs of intoxication: bloodshot eyes, strong odor of alcohol, slurred speech.',
                    observations: ['Bloodshot eyes', 'Strong odor of alcohol', 'Slurred speech', 'Weaving between lanes']
                },
                traffic_warrant: {
                    title: 'Traffic Stop - Warrant',
                    location: 'Main St & 7th Ave, 2:30 PM',
                    icon: '',
                    intro: 'Routine traffic stop for expired registration. Dispatch advises driver has active felony warrant for failure to appear.',
                    observations: ['Expired registration', 'Active warrant on file', 'Driver nervous', 'Passenger in vehicle']
                },
                traffic_drugs: {
                    title: 'Traffic Stop - Narcotics',
                    location: 'Interstate 10, 1:15 AM',
                    icon: '',
                    intro: 'Vehicle stopped for equipment violation. Strong odor of marijuana emanating from vehicle. Driver appears nervous and fidgety.',
                    observations: ['Marijuana odor', 'Air fresheners visible', 'Nervous behavior', 'Fast food bags/trash']
                },
                traffic_suspended: {
                    title: 'Suspended License',
                    location: 'Central Ave, 4:45 PM',
                    icon: '',
                    intro: 'Vehicle stopped for running red light. Driver unable to produce license, claims to have left it at home.',
                    observations: ['Traffic violation observed', 'No license produced', 'Registration in another name', 'Driver hesitant']
                },
                // Domestic/Violence
                domestic: {
                    title: 'Domestic Violence Call',
                    location: '1847 W Elm St, 9:15 PM',
                    icon: '',
                    intro: 'Dispatch reports neighbors called about yelling and breaking glass. Male and female voices heard arguing. You approach the front door.',
                    observations: ['Broken glass on porch', 'Yelling from inside', 'Crying heard', 'Damaged door frame']
                },
                domestic_weapons: {
                    title: 'DV - Weapons Involved',
                    location: '2234 N Desert Dr, 10:30 PM',
                    icon: '',
                    intro: 'Caller reports partner threatened them with a knife during argument. Caller locked in bathroom. Suspect may still have weapon.',
                    observations: ['Weapon mentioned', 'Victim barricaded', 'Ongoing argument', 'Children may be present']
                },
                assault: {
                    title: 'Assault in Progress',
                    location: 'Circle K Parking Lot, 8:45 PM',
                    icon: '',
                    intro: 'Two males fighting in parking lot. One appears injured. Crowd gathering. Unknown if weapons involved.',
                    observations: ['Physical altercation', 'Visible injuries', 'Crowd present', 'Unknown weapon status']
                },
                threats: {
                    title: 'Threatening/Intimidation',
                    location: 'Sunrise Apartments #204, 6:30 PM',
                    icon: '',
                    intro: 'Resident reports neighbor threatened to harm them after noise complaint. Suspect made specific threats about "teaching them a lesson."',
                    observations: ['Verbal threats made', 'Prior disputes', 'Witnesses available', 'Suspect in unit']
                },
                // Property Crimes
                shoplifting: {
                    title: 'Shoplifting - Retail',
                    location: 'Target Store #4521, 3:30 PM',
                    icon: '',
                    intro: 'Loss prevention has detained a suspect who allegedly concealed merchandise. Subject is being held in the LP office. Store manager is present.',
                    observations: ['Concealed merchandise', 'Subject detained by LP', 'Store video available', 'Witness present']
                },
                burglary: {
                    title: 'Burglary in Progress',
                    location: '445 E Commerce St, 3:15 AM',
                    icon: '',
                    intro: 'Silent alarm triggered at closed business. Back door appears forced open. Unknown if suspect still inside.',
                    observations: ['Forced entry signs', 'Alarm triggered', 'Business closed', 'Unknown occupancy']
                },
                theft: {
                    title: 'Theft Report',
                    location: 'Victim residence, 5:00 PM',
                    icon: '',
                    intro: 'Victim reports items stolen from unlocked vehicle overnight. Neighbor saw suspicious person in area around 2 AM.',
                    observations: ['Vehicle entered', 'Items missing', 'Witness available', 'No forced entry']
                },
                vehicle_theft: {
                    title: 'Vehicle Theft Recovery',
                    location: 'Industrial Blvd, 11:30 PM',
                    icon: '',
                    intro: 'Plate reader hit on stolen vehicle. Vehicle occupied, pulled into parking lot. Driver claims to have borrowed car from friend.',
                    observations: ['Stolen vehicle confirmed', 'Occupant present', 'No keys visible', 'Ignition damage possible']
                },
                // Trespass/Disturbance
                trespass: {
                    title: 'Criminal Trespass',
                    location: 'Abandoned Warehouse, 2:15 AM',
                    icon: '',
                    intro: 'Security guard reports individual refusing to leave private property after being asked multiple times. Subject appears to be camping in the area.',
                    observations: ['No Trespassing signs', 'Prior warning given', 'Personal belongings', 'Subject aware of status']
                },
                disturbance: {
                    title: 'Disorderly Conduct',
                    location: 'Murphys Bar & Grill, 11:50 PM',
                    icon: '',
                    intro: 'Bar staff reports intoxicated male yelling at other patrons and knocking over furniture. Subject has been asked to leave but refuses.',
                    observations: ['Strong alcohol odor', 'Overturned furniture', 'Crowd gathering', 'Subject yelling']
                },
                noise: {
                    title: 'Noise Complaint',
                    location: '892 W University Dr, 1:30 AM',
                    icon: '',
                    intro: 'Multiple calls about loud party. Music audible from street. This is third complaint tonight from same address.',
                    observations: ['Loud music audible', 'Multiple complaints', 'Prior warnings tonight', 'Large gathering']
                },
                loitering: {
                    title: 'Loitering/Panhandling',
                    location: 'QuikTrip #127, 4:00 PM',
                    icon: '',
                    intro: 'Store manager reports aggressive panhandler blocking entrance and harassing customers. Subject has been previously trespassed.',
                    observations: ['Blocking entrance', 'Prior trespass', 'Customers harassed', 'Subject refusing to leave']
                },
                // Civil Disputes
                civil_property: {
                    title: 'Civil - Property Dispute',
                    location: '1122 & 1124 Oak Lane, 2:00 PM',
                    icon: '',
                    intro: 'Two neighbors in heated argument over property line. One claims other built fence on their property. Both demanding action.',
                    observations: ['Property line dispute', 'Both parties present', 'No physical contact', 'Civil matter']
                },
                civil_custody: {
                    title: 'Civil - Custody Exchange',
                    location: 'McDonalds Parking Lot, 6:00 PM',
                    icon: '',
                    intro: 'Mother refusing to release child to father for scheduled visitation. Father has court order. Both parties arguing.',
                    observations: ['Court order present', 'Child present', 'Verbal argument', 'Custody dispute']
                },
                civil_landlord: {
                    title: 'Civil - Landlord/Tenant',
                    location: 'Sunset Apartments #15, 10:00 AM',
                    icon: '',
                    intro: 'Tenant reports landlord changed locks while they were at work. Tenant claims rent is paid. Landlord claims eviction was filed.',
                    observations: ['Lockout situation', 'Disputed rent status', 'No court order shown', 'Belongings inside']
                },
                civil_repo: {
                    title: 'Civil - Repossession',
                    location: '567 Pine St, 7:00 AM',
                    icon: '',
                    intro: 'Repo company requesting standby while recovering vehicle. Owner came outside and is blocking tow truck. Repo agent has paperwork.',
                    observations: ['Valid repo order', 'Owner obstructing', 'Vehicle in driveway', 'Civil matter']
                },
                civil_business: {
                    title: 'Civil - Business Dispute',
                    location: 'Auto Repair Shop, 3:30 PM',
                    icon: '',
                    intro: 'Customer refusing to pay repair bill, claims work was not authorized. Shop refusing to release vehicle. Both parties yelling.',
                    observations: ['Payment dispute', 'Vehicle held', 'Verbal altercation', 'Civil matter']
                },
                // Mental Health/Welfare
                mental_crisis: {
                    title: 'Mental Health Crisis',
                    location: 'Bus Stop - Central Station, 4:15 PM',
                    icon: '',
                    intro: 'Subject talking to themselves, appears agitated, scaring other passengers. May be off medication. No weapons observed.',
                    observations: ['Erratic behavior', 'Talking to self', 'Agitated state', 'Public location']
                },
                welfare_check: {
                    title: 'Welfare Check',
                    location: '789 Maple Ave, 11:00 AM',
                    icon: '',
                    intro: 'Family requests welfare check. Elderly resident hasnt answered phone in 3 days. Mail piling up. Vehicle in driveway.',
                    observations: ['No contact 3 days', 'Mail accumulating', 'Vehicle present', 'Medical concerns']
                },
                suicide_threat: {
                    title: 'Suicide Threat',
                    location: '456 River Rd, 8:30 PM',
                    icon: '',
                    intro: 'Friend called 911 after receiving text messages about suicide. Subject not answering phone. May have access to firearms.',
                    observations: ['Suicidal statements', 'Not responding', 'Possible weapons', 'Friend on scene']
                },
                intoxicated: {
                    title: 'Intoxicated Person',
                    location: 'City Park Bench, 2:45 PM',
                    icon: '',
                    intro: 'Subject passed out on park bench. Not responsive to passersby. Unknown medical status. Empty bottles nearby.',
                    observations: ['Unresponsive', 'Alcohol containers', 'Public location', 'Medical status unknown']
                },
                // Other
                suspicious: {
                    title: 'Suspicious Person',
                    location: 'Residential neighborhood, 10:30 PM',
                    icon: '',
                    intro: 'Multiple calls about male walking through yards, looking into windows. Subject wearing dark clothing, carrying backpack.',
                    observations: ['Looking in windows', 'Dark clothing', 'Backpack', 'Multiple reports']
                },
                alarm: {
                    title: 'Alarm Response',
                    location: 'First National Bank, 2:30 AM',
                    icon: '',
                    intro: 'Silent alarm triggered at bank. All doors appear secure from exterior. Key holder en route, ETA 15 minutes.',
                    observations: ['Silent alarm', 'Doors appear secure', 'Key holder notified', 'No visible activity']
                },
                harassment: {
                    title: 'Harassment',
                    location: 'Victim workplace, 1:00 PM',
                    icon: '',
                    intro: 'Victim reports ex-partner sending threatening texts and showing up at workplace. Has documentation of 50+ messages today.',
                    observations: ['Multiple messages', 'Workplace contact', 'Prior relationship', 'Documentation available']
                },
                stalking: {
                    title: 'Stalking',
                    location: 'Victim residence, 7:30 PM',
                    icon: '',
                    intro: 'Victim reports being followed for past two weeks. Same vehicle seen near home and work. Photos and log provided.',
                    observations: ['Pattern of behavior', 'Vehicle identified', 'Documentation provided', 'Ongoing concern']
                },
                random: {
                    title: 'Unknown Scenario',
                    location: 'Dispatched Location',
                    icon: '',
                    intro: 'Respond to the call. Details will be revealed upon arrival.',
                    observations: ['Awaiting details', 'Stay alert', 'Assess on arrival']
                }
            };

            var DIFFICULTY_MODIFIERS = {
                trainee: 'The subject is very cooperative, immediately compliant, and provides clear answers. Perfect for learning basic procedures without complications.',
                easy: 'The subject is mostly cooperative but may ask questions or show mild reluctance. Provides clear indicators and responds to authority.',
                medium: 'The subject is evasive, tries to talk their way out, and requires persistence. May become slightly agitated if pressed but eventually complies.',
                hard: 'The subject is resistant, argumentative, and challenges your authority. May attempt to leave or escalate. Requires firm command presence.',
                expert: 'The subject is hostile, potentially volatile, and may attempt to flee or fight. Complex legal issues arise. Situation may involve weapons or multiple subjects.'
            };

            var MOOD_CONFIG = {
                calm: { emoji: '', label: 'Calm' },
                nervous: { emoji: '', label: 'Nervous' },
                agitated: { emoji: '', label: 'Agitated' },
                hostile: { emoji: '', label: 'Hostile' },
                defeated: { emoji: '', label: 'Defeated' }
            };

            function updateSubjectMood(mood, action) {
                if (!mood) mood = 'nervous';
                currentMood = mood;

                var config = MOOD_CONFIG[mood] || MOOD_CONFIG.nervous;

                var portrait = document.getElementById('subject-portrait');
                var face = document.getElementById('portrait-face');
                var badge = document.getElementById('subject-mood-badge');
                var moodText = document.getElementById('mood-text');
                var actionEl = document.getElementById('subject-action');

                portrait.className = 'subject-portrait mood-' + mood;
                face.textContent = config.emoji;
                badge.className = 'subject-mood mood-' + mood;
                moodText.textContent = config.label;

                if (action) {
                    actionEl.textContent = action;
                }
            }

            function addObservations(newObs) {
                var list = document.getElementById('observation-list');
                newObs.forEach(function(obs) {
                    // Check if observation already exists
                    var existing = list.querySelectorAll('.observation-tag');
                    var found = false;
                    for (var i = 0; i < existing.length; i++) {
                        if (existing[i].textContent.trim().toLowerCase() === obs.toLowerCase()) {
                            found = true;
                            break;
                        }
                    }
                    if (!found) {
                        var tag = document.createElement('span');
                        tag.className = 'observation-tag';
                        tag.style.animation = 'messageIn 0.4s ease-out';

                        // Add eye icon
                        var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                        svg.setAttribute('viewBox', '0 0 24 24');
                        svg.setAttribute('stroke-width', '2');
                        var path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                        path.setAttribute('d', 'M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z');
                        var circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                        circle.setAttribute('cx', '12');
                        circle.setAttribute('cy', '12');
                        circle.setAttribute('r', '3');
                        svg.appendChild(path);
                        svg.appendChild(circle);

                        tag.appendChild(svg);
                        tag.appendChild(document.createTextNode(' ' + obs));
                        list.appendChild(tag);
                    }
                });
            }

            function createElement(tag, className, textContent) {
                var el = document.createElement(tag);
                if (className) el.className = className;
                if (textContent) el.textContent = textContent;
                return el;
            }

            function addMessage(type, text, hint) {
                var messageDiv = createElement('div', 'message');
                messageDiv.style.animation = 'messageIn 0.4s ease-out';

                if (type === 'system') {
                    messageDiv.className = 'message message-system';
                    var content = createElement('div', 'message-content', text);
                    messageDiv.appendChild(content);
                } else if (type === 'subject') {
                    messageDiv.className = 'message message-subject';
                    var label = createElement('div', 'message-label', 'Subject');
                    var content = createElement('div', 'message-content', text);
                    messageDiv.appendChild(label);
                    messageDiv.appendChild(content);
                } else if (type === 'officer') {
                    messageDiv.className = 'message message-officer';
                    var label = createElement('div', 'message-label', 'You');
                    var content = createElement('div', 'message-content', text);
                    messageDiv.appendChild(label);
                    messageDiv.appendChild(content);
                } else if (type === 'loading') {
                    messageDiv.className = 'message message-subject';
                    messageDiv.id = 'loading-message';
                    var label = createElement('div', 'message-label', 'Subject');
                    var content = createElement('div', 'message-content', 'Thinking...');
                    content.style.fontStyle = 'italic';
                    content.style.opacity = '0.7';
                    messageDiv.appendChild(label);
                    messageDiv.appendChild(content);
                }

                messagesContainer.appendChild(messageDiv);

                if (hint) {
                    var hintDiv = createElement('div', 'hint-panel');
                    var hintBox = createElement('div', 'hint-box');
                    hintBox.style.animation = 'hintIn 0.5s ease-out';

                    var iconSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                    iconSvg.setAttribute('class', 'hint-icon');
                    iconSvg.setAttribute('viewBox', '0 0 24 24');
                    iconSvg.setAttribute('fill', 'none');
                    iconSvg.setAttribute('stroke', 'currentColor');
                    iconSvg.setAttribute('stroke-width', '2');
                    var circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    circle.setAttribute('cx', '12');
                    circle.setAttribute('cy', '12');
                    circle.setAttribute('r', '10');
                    var path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    path.setAttribute('d', 'M12 16v-4M12 8h.01');
                    iconSvg.appendChild(circle);
                    iconSvg.appendChild(path);

                    var hintContent = createElement('div', 'hint-content');
                    var strong = createElement('strong', null, 'Training Hint');
                    hintContent.appendChild(strong);
                    hintContent.appendChild(document.createTextNode(' ' + hint));

                    hintBox.appendChild(iconSvg);
                    hintBox.appendChild(hintContent);
                    hintDiv.appendChild(hintBox);
                    messagesContainer.appendChild(hintDiv);
                }

                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            function removeLoading() {
                var loading = document.getElementById('loading-message');
                if (loading) loading.remove();
            }

            function startTimer() {
                timerStart = Date.now();
                timerDisplay.classList.add('active');
                timerInterval = setInterval(function() {
                    var elapsed = (Date.now() - timerStart) / 1000;
                    timerDisplay.textContent = elapsed.toFixed(1) + 's';
                }, 100);
            }

            function stopTimer() {
                if (timerInterval) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                }
                timerDisplay.classList.remove('active');
            }

            function setLoading(loading) {
                isLoading = loading;
                inputSay.disabled = loading;
                inputDo.disabled = loading;
                inputRadio.disabled = loading;
                sendBtn.disabled = loading;
                if (loading) {
                    addMessage('loading');
                    startTimer();
                } else {
                    removeLoading();
                    stopTimer();
                }
            }

            function startDemo() {
                demoStarted = true;
                messages = [];
                messagesContainer.textContent = '';

                // Handle random scenario selection
                var actualScenario = selectedScenario;
                if (selectedScenario === 'random') {
                    var scenarioKeys = Object.keys(SCENARIOS).filter(function(k) { return k !== 'random'; });
                    actualScenario = scenarioKeys[Math.floor(Math.random() * scenarioKeys.length)];
                }

                var scenario = SCENARIOS[actualScenario];

                // Update header
                document.querySelector('#demo-chat-section .scenario-info h3').textContent = scenario.title;
                document.querySelector('#demo-chat-section .scenario-info span').textContent = scenario.location;

                // Update observations
                var obsList = document.getElementById('observation-list');
                obsList.textContent = '';
                scenario.observations.forEach(function(obs, i) {
                    var tag = document.createElement('span');
                    tag.className = 'observation-tag' + (i < 2 ? ' warning' : '');

                    var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                    svg.setAttribute('viewBox', '0 0 24 24');
                    svg.setAttribute('stroke-width', '2');
                    var path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    path.setAttribute('d', 'M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z');
                    var circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    circle.setAttribute('cx', '12');
                    circle.setAttribute('cy', '12');
                    circle.setAttribute('r', '3');
                    svg.appendChild(path);
                    svg.appendChild(circle);

                    tag.appendChild(svg);
                    tag.appendChild(document.createTextNode(' ' + obs));
                    obsList.appendChild(tag);
                });

                updateSubjectMood('nervous', 'Tense body language');

                var introText = scenario.intro;
                messages.push({ role: 'system', content: introText });
                addMessage('system', introText);

                // Store actual scenario for API calls
                selectedScenario = actualScenario;
                sendToAPI('');
            }

            function sendToAPI(officerMessage) {
                setLoading(true);

                if (officerMessage) {
                    messages.push({ role: 'officer', content: officerMessage });
                }

                fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'chat',
                        messages: messages,
                        message: officerMessage,
                        training_mode: true,
                        scenario: selectedScenario,
                        difficulty: selectedDifficulty,
                        scenario_config: SCENARIOS[selectedScenario],
                        difficulty_modifier: DIFFICULTY_MODIFIERS[selectedDifficulty]
                    })
                })
                .then(function(response) { return response.json(); })
                .then(function(data) {
                    setLoading(false);

                    var subjectResponse = data.subject_response || 'No response';
                    messages.push({
                        role: 'subject',
                        content: subjectResponse,
                        raw_response: data.raw_response,
                        evaluation: data.evaluation
                    });

                    updateSubjectMood(data.subject_mood, data.subject_action);
                    addMessage('subject', subjectResponse, data.hint);

                    // Add new observations
                    if (data.new_observations && data.new_observations.length > 0) {
                        addObservations(data.new_observations);
                    }

                    if (data.scenario_complete) {
                        setTimeout(function() { requestDebrief(); }, 1500);
                    }
                })
                .catch(function(err) {
                    setLoading(false);
                    console.error('API Error:', err);
                    addMessage('system', 'Error connecting to server. Please try again.');
                });
            }

            function requestDebrief() {
                setLoading(true);
                inputSay.placeholder = 'Generating debrief...';

                fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'debrief',
                        messages: messages
                    })
                })
                .then(function(response) { return response.json(); })
                .then(function(data) {
                    setLoading(false);
                    showDebrief(data);
                })
                .catch(function(err) {
                    setLoading(false);
                    console.error('Debrief Error:', err);
                    showDebrief({ score: 75, summary: 'Unable to generate detailed debrief.', legal_analysis: [], recommendations: 'Please try again.' });
                });
            }

            function showDebrief(data) {
                chatSection.style.display = 'none';
                debriefSection.classList.add('active');

                // Update scenario score
                var score = data.score || 75;
                updateScenarioScore(selectedScenario, score);

                var scoreEl = debriefSection.querySelector('.debrief-score');
                scoreEl.textContent = '';
                var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('width', '20');
                svg.setAttribute('height', '20');
                svg.setAttribute('viewBox', '0 0 24 24');
                svg.setAttribute('fill', 'none');
                svg.setAttribute('stroke', 'currentColor');
                svg.setAttribute('stroke-width', '2');
                var path1 = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path1.setAttribute('d', 'M22 11.08V12a10 10 0 1 1-5.93-9.14');
                var path2 = document.createElementNS('http://www.w3.org/2000/svg', 'polyline');
                path2.setAttribute('points', '22 4 12 14.01 9 11.01');
                svg.appendChild(path1);
                svg.appendChild(path2);
                scoreEl.appendChild(svg);
                scoreEl.appendChild(document.createTextNode(' ' + (data.score || 75) + '/100'));

                var sections = debriefSection.querySelectorAll('.debrief-section');

                if (sections[0] && data.legal_analysis && data.legal_analysis.length > 0) {
                    var itemsContainer = sections[0].querySelector('.debrief-item');
                    if (itemsContainer) {
                        var parent = itemsContainer.parentNode;
                        var heading = sections[0].querySelector('h3');
                        while (parent.lastChild !== heading) {
                            parent.removeChild(parent.lastChild);
                        }

                        data.legal_analysis.forEach(function(item) {
                            var itemDiv = createElement('div', 'debrief-item');
                            var statusSpan = createElement('span', 'debrief-status');
                            statusSpan.className = 'debrief-status ' + (item.status === 'correct' ? 'status-correct' : 'status-issue');
                            statusSpan.textContent = item.status === 'correct' ? '\u2713' : '!';

                            var p = createElement('p');
                            var strong = createElement('strong', null, item.topic + ': ');
                            p.appendChild(strong);
                            p.appendChild(document.createTextNode(item.detail));
                            if (item.ars_reference) {
                                var code = createElement('code', null, ' ' + item.ars_reference);
                                p.appendChild(code);
                            }

                            itemDiv.appendChild(statusSpan);
                            itemDiv.appendChild(p);
                            parent.appendChild(itemDiv);
                        });
                    }
                }

                if (sections[1] && data.recommendations) {
                    var recP = sections[1].querySelector('p');
                    if (recP) recP.textContent = data.recommendations;
                }
            }

            function openDemo() {
                modal.classList.add('active');
                scenarioSelectSection.style.display = 'block';
                chatSection.style.display = 'none';
                debriefSection.classList.remove('active');
                demoStarted = false;
            }

            function startScenario() {
                scenarioSelectSection.style.display = 'none';
                chatSection.style.display = 'block';
                inputSay.placeholder = 'What do you say to the subject...';
                inputDo.placeholder = 'Physical actions you take...';
                inputRadio.placeholder = 'Radio communication...';
                timerDisplay.textContent = '0.0s';
                startDemo();
            }

            function closeDemo() {
                modal.classList.remove('active');
                demoStarted = false;
                messages = [];
                inputSay.value = '';
                inputDo.value = '';
                inputRadio.value = '';
                stopTimer();
                timerDisplay.textContent = '0.0s';
            }

            function buildOfficerMessage() {
                var say = inputSay.value.trim();
                var doAction = inputDo.value.trim();
                var radio = inputRadio.value.trim();

                var parts = [];
                if (say) parts.push('[SAYS]: "' + say + '"');
                if (doAction) parts.push('[DOES]: ' + doAction);
                if (radio) parts.push('[RADIOS]: "' + radio + '"');

                return {
                    combined: parts.join('\n'),
                    say: say,
                    do: doAction,
                    radio: radio
                };
            }

            function sendMessage() {
                var input = buildOfficerMessage();
                if (!input.combined || isLoading) return;

                inputSay.value = '';
                inputDo.value = '';
                inputRadio.value = '';
                addOfficerMessage(input);
                sendToAPI(input.combined);
            }

            function addOfficerMessage(input) {
                var messageDiv = createElement('div', 'message message-officer');
                messageDiv.style.animation = 'messageIn 0.4s ease-out';

                var label = createElement('div', 'message-label', 'You');
                messageDiv.appendChild(label);

                var content = createElement('div', 'message-content');

                if (input.say) {
                    var sayLine = createElement('div');
                    sayLine.style.marginBottom = '0.35rem';
                    var sayIcon = createElement('span');
                    sayIcon.style.color = 'var(--tactical-blue)';
                    sayIcon.style.marginRight = '0.35rem';
                    sayIcon.textContent = '';
                    sayLine.appendChild(sayIcon);
                    sayLine.appendChild(document.createTextNode('"' + input.say + '"'));
                    content.appendChild(sayLine);
                }

                if (input.do) {
                    var doLine = createElement('div');
                    doLine.style.marginBottom = '0.35rem';
                    doLine.style.fontStyle = 'italic';
                    doLine.style.color = 'var(--accent-gold)';
                    var doIcon = createElement('span');
                    doIcon.style.marginRight = '0.35rem';
                    doIcon.textContent = '';
                    doLine.appendChild(doIcon);
                    doLine.appendChild(document.createTextNode(input.do));
                    content.appendChild(doLine);
                }

                if (input.radio) {
                    var radioLine = createElement('div');
                    radioLine.style.color = 'var(--success)';
                    var radioIcon = createElement('span');
                    radioIcon.style.marginRight = '0.35rem';
                    radioIcon.textContent = '';
                    radioLine.appendChild(radioIcon);
                    radioLine.appendChild(document.createTextNode('"' + input.radio + '"'));
                    content.appendChild(radioLine);
                }

                messageDiv.appendChild(content);
                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            document.getElementById('nav-demo-btn').addEventListener('click', openDemo);
            document.getElementById('hero-demo-btn').addEventListener('click', openDemo);
            document.getElementById('modal-close-btn').addEventListener('click', closeDemo);
            document.getElementById('demo-send-btn').addEventListener('click', sendMessage);
            document.getElementById('debrief-cta-btn').addEventListener('click', closeDemo);
            document.getElementById('start-scenario-btn').addEventListener('click', startScenario);

            // Scenario selection
            document.querySelectorAll('.scenario-card').forEach(function(card) {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.scenario-card').forEach(function(c) {
                        c.classList.remove('selected');
                    });
                    card.classList.add('selected');
                    selectedScenario = card.dataset.scenario;
                });
            });

            // Difficulty selection
            document.querySelectorAll('.difficulty-card').forEach(function(card) {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.difficulty-card').forEach(function(c) {
                        c.classList.remove('selected');
                    });
                    card.classList.add('selected');
                    selectedDifficulty = card.dataset.difficulty;
                });
            });

            // Ctrl+Enter to submit from any input
            function handleKeydown(event) {
                if ((event.ctrlKey || event.metaKey) && event.key === 'Enter') {
                    event.preventDefault();
                    sendMessage();
                }
            }
            inputSay.addEventListener('keydown', handleKeydown);
            inputDo.addEventListener('keydown', handleKeydown);
            inputRadio.addEventListener('keydown', handleKeydown);

            modal.addEventListener('click', function(e) {
                if (e.target === modal) closeDemo();
            });

            document.getElementById('checkout-btn').addEventListener('click', function() {
                alert('Stripe checkout will be integrated here. For now, contact us to get started!');
            });

            // FI Card toggle
            document.getElementById('fi-card-toggle').addEventListener('click', function() {
                this.classList.toggle('open');
                document.getElementById('fi-card-panel').classList.toggle('open');
            });

            // Make radio buttons deselectable by clicking again
            document.querySelectorAll('.fi-card-form input[type="radio"]').forEach(function(radio) {
                radio.addEventListener('click', function(e) {
                    if (this.dataset.wasChecked === 'true') {
                        this.checked = false;
                        this.dataset.wasChecked = 'false';
                    } else {
                        // Unmark all radios in same group
                        document.querySelectorAll('input[name="' + this.name + '"]').forEach(function(r) {
                            r.dataset.wasChecked = 'false';
                        });
                        this.dataset.wasChecked = 'true';
                    }
                });
            });

            // Initialize scores display
            renderAllScores();
        })();
    </script>
</body>
</html>
